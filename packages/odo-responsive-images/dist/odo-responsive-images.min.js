!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("picturefill"),require("@odopod/odo-viewport")):"function"==typeof define&&define.amd?define(["picturefill","@odopod/odo-viewport"],t):e.OdoResponsiveImages=t(e.picturefill,e.OdoViewport)}(this,function(e,t){"use strict";function o(e){return Array.isArray(e)?e:"number"==typeof e.length?Array.from(e):[e]}function r(e,t){for(var o=document.createDocumentFragment(),r=Array.from(e.childNodes),n=0;n<r.length;n++)"NOSCRIPT"!==r[n].nodeName&&o.appendChild(r[n]);t.appendChild(o)}function n(e){return e&&1===e.nodeType}e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t;var a=function(e,t,o){function r(){var l=Date.now()-s;l<t&&l>=0?n=setTimeout(r,t-l):(n=null,o||(d=e.apply(i,a),i=a=null))}var n,a,i,s,d;null==t&&(t=100);var l=function(){i=this,a=arguments,s=Date.now();var l=o&&!n;return n||(n=setTimeout(r,t)),l&&(d=e.apply(i,a),i=a=null),d};return l.clear=function(){n&&(clearTimeout(n),n=null)},l},i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(){function s(){i(this,s),this.ClassName={IMAGE:"odo-responsive-img",LOADED:"odo-responsive-img--loaded"},this.images=[],this._imageLoadHandler=this._handleImageLoad.bind(this),this._imageInViewHandler=this._handleImageInView.bind(this),this.updateOffsets=a(this._update,s.DEBOUNCE_TIME)}return s.prototype.initialize=function(){this._add(Array.from(document.querySelectorAll("."+this.ClassName.IMAGE+":not(picture)")))},s.prototype._add=function(e){var o=this,r=e.map(function(e){return o._getViewportOptions(e)}),n=t.add(r);this.images=this.images.concat(n.map(function(t,o){return{id:t,element:e[o]}}))},s.prototype._getViewportOptions=function(e){return{element:e,threshold:e.getAttribute("data-threshold")||0,enter:this._imageInViewHandler}},s.prototype._handleImageInView=function(e){this._loadImage(e.element)},s.prototype._loadImage=function(t){var o=t.querySelector("img");if(!o)throw new Error("Unable to find <img> element within Odo Responsive Images placeholder.");var n=o.getAttribute("data-srcset");if(null!==n)o.srcset=n,o.setAttribute("srcset",n),o.removeAttribute("data-srcset"),t._odoResponsiveImageUsed=!0;else{var a=t.parentNode,i=document.createElement("picture");i.className=t.className,r(t,i);var s=t.getAttribute("data-type");s&&i.setAttribute("data-type",s),o=i.querySelector("img"),a.replaceChild(i,t),i._odoResponsiveImageUsed=!0}this._removeImageEntry(t),this.isImageLoaded(o)&&setTimeout(this._handleImageLoad.bind(this,{target:o}),30),o.addEventListener("load",this._imageLoadHandler,!1),o.addEventListener("error",this._imageLoadHandler,!1),e({elements:[o]})},s.prototype._getImageIndexByPlaceholder=function(e){for(var t=null,o=0,r=this.images.length;o<r;o++)if(this.images[o].element===e){t=o;break}return t},s.prototype._removeImageEntry=function(e){var o=this._getImageIndexByPlaceholder(e);null!==o&&(t.remove(this.images[o].id),this.images.splice(o,1))},s.prototype.isImageLoaded=function(e){return e.naturalWidth>0},s.prototype._isBackgroundImage=function(e){return"background"===e.parentNode.getAttribute("data-type")},s.prototype._isUnloadedResponsiveImage=function(e){if(!n(e))throw new TypeError('Odo Responsive Images requires an element. Got: "'+e+'"');if(!e.classList.contains(this.ClassName.IMAGE))throw new TypeError(e+" is not a Odo Responsive Image.");return!0!==e._odoResponsiveImageUsed},s.prototype.isUntrackedImage=function(e){return null===this._getImageIndexByPlaceholder(e)},s.prototype._handleImageLoad=function(e){var t=this,o=e.target;o.parentNode&&(this.updateOffsets(),this._isBackgroundImage(o)?this._updateBackgroundImage(o):this._removeImageHandlers(o),requestAnimationFrame(function(){o.parentNode.classList.add(t.ClassName.LOADED)}))},s.prototype._updateBackgroundImage=function(e){e.parentNode.style.backgroundImage='url("'+(e.currentSrc||e.src)+'")'},s.prototype._update=function(){t.update()},s.prototype._removeImageHandlers=function(e){e&&(e.removeEventListener("load",this._imageLoadHandler,!1),e.removeEventListener("error",this._imageLoadHandler,!1))},s.prototype.flush=function(){var e=this;this.images.forEach(function(o){var r=o.element.querySelector("img");e._removeImageHandlers(r),t.remove(o.id)}),this.images.length=0;var o="."+this.ClassName.IMAGE+'[data-type="background"] img';Array.from(document.querySelectorAll(o)).forEach(function(t){e._removeImageHandlers(t)})},s.prototype.remove=function(e){var t=this;o(e).forEach(function(e){t._removeImageEntry(e),t._removeImageHandlers(e.querySelector("img"))})},s.prototype.add=function(e){var t=o(e).filter(this._isUnloadedResponsiveImage,this).filter(this.isUntrackedImage,this);0!==t.length&&this._add(t)},s.prototype.load=function(e){o(e).filter(this._isUnloadedResponsiveImage,this).forEach(this._loadImage,this)},s}();return s.DEBOUNCE_TIME=300,new s});
//# sourceMappingURL=odo-responsive-images.min.js.map
