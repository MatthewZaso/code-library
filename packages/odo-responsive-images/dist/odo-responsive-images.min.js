!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("picturefill"),require("@odopod/odo-viewport")):"function"==typeof define&&define.amd?define(["picturefill","@odopod/odo-viewport"],t):e.OdoResponsiveImages=t(e.picturefill,e.OdoViewport)}(this,function(e,t){"use strict";function o(e){return Array.isArray(e)?e:e&&"number"==typeof e.length?Array.from(e):[e]}e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t;var r=function(e,t,o){function r(){var l=Date.now()-s;l<t&&l>=0?n=setTimeout(r,t-l):(n=null,o||(d=e.apply(i,a),i=a=null))}var n,a,i,s,d;null==t&&(t=100);var l=function(){i=this,a=arguments,s=Date.now();var l=o&&!n;return n||(n=setTimeout(r,t)),l&&(d=e.apply(i,a),i=a=null),d};return l.clear=function(){n&&(clearTimeout(n),n=null)},l},n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},a=function(){function a(){n(this,a),this.ClassName={IMAGE:"odo-responsive-img",LOADED:"odo-responsive-img--loaded"},this.images=[],this._imageLoadHandler=this._handleImageLoad.bind(this),this._imageInViewHandler=this._handleImageInView.bind(this),this.updateOffsets=r(this._update,a.DEBOUNCE_TIME)}return a.prototype.initialize=function(){this._add(Array.from(document.querySelectorAll("."+this.ClassName.IMAGE+":not(picture)")))},a.prototype._add=function(e){var o=this,r=e.map(function(e){return o._getViewportOptions(e)}),n=t.add(r);this.images=this.images.concat(n.map(function(t,o){return{id:t,element:e[o]}}))},a.prototype._getViewportOptions=function(e){return{element:e,threshold:e.getAttribute("data-threshold")||0,enter:this._imageInViewHandler}},a.prototype._handleImageInView=function(e){this._loadImage(e.element)},a.prototype._loadImage=function(t){var o=t.querySelector("img");if(!o)throw new Error("Unable to find <img> element within Odo Responsive Images placeholder.");var r=o.getAttribute("data-srcset");if(null!==r)o.srcset=r,o.setAttribute("srcset",r),o.removeAttribute("data-srcset"),t._odoResponsiveImageUsed=!0;else{var n=t.parentNode,a=document.createElement("picture");a.className=t.className,function(e,t){for(var o=document.createDocumentFragment(),r=Array.from(e.childNodes),n=0;n<r.length;n++)"NOSCRIPT"!==r[n].nodeName&&o.appendChild(r[n]);t.appendChild(o)}(t,a);var i=t.getAttribute("data-type");i&&a.setAttribute("data-type",i),o=a.querySelector("img"),n.replaceChild(a,t),a._odoResponsiveImageUsed=!0}this._removeImageEntry(t),this.isImageLoaded(o)&&setTimeout(this._handleImageLoad.bind(this,{target:o}),30),o.addEventListener("load",this._imageLoadHandler,!1),o.addEventListener("error",this._imageLoadHandler,!1),e({elements:[o]})},a.prototype._getImageIndexByPlaceholder=function(e){for(var t=null,o=0,r=this.images.length;o<r;o++)if(this.images[o].element===e){t=o;break}return t},a.prototype._removeImageEntry=function(e){var o=this._getImageIndexByPlaceholder(e);null!==o&&(t.remove(this.images[o].id),this.images.splice(o,1))},a.prototype.isImageLoaded=function(e){return e.naturalWidth>0},a.prototype._isBackgroundImage=function(e){return"background"===e.parentNode.getAttribute("data-type")},a.prototype._isUnloadedResponsiveImage=function(e){if(!function(e){return e&&1===e.nodeType}(e))throw new TypeError('Odo Responsive Images requires an element. Got: "'+e+'"');if(!e.classList.contains(this.ClassName.IMAGE))throw new TypeError(e+" is not a Odo Responsive Image.");return!0!==e._odoResponsiveImageUsed},a.prototype.isUntrackedImage=function(e){return null===this._getImageIndexByPlaceholder(e)},a.prototype._handleImageLoad=function(e){var t=this,o=e.target;o.parentNode&&(this.updateOffsets(),this._isBackgroundImage(o)?this._updateBackgroundImage(o):this._removeImageHandlers(o),requestAnimationFrame(function(){o.parentNode.classList.add(t.ClassName.LOADED)}))},a.prototype._updateBackgroundImage=function(e){e.parentNode.style.backgroundImage='url("'+(e.currentSrc||e.src)+'")'},a.prototype._update=function(){t.update()},a.prototype._removeImageHandlers=function(e){e&&(e.removeEventListener("load",this._imageLoadHandler,!1),e.removeEventListener("error",this._imageLoadHandler,!1))},a.prototype.flush=function(){var e=this;this.images.forEach(function(o){var r=o.element.querySelector("img");e._removeImageHandlers(r),t.remove(o.id)}),this.images.length=0;var o="."+this.ClassName.IMAGE+'[data-type="background"] img';Array.from(document.querySelectorAll(o)).forEach(function(t){e._removeImageHandlers(t)})},a.prototype.remove=function(e){var t=this;o(e).forEach(function(e){t._removeImageEntry(e),t._removeImageHandlers(e.querySelector("img"))})},a.prototype.add=function(e){var t=o(e).filter(this._isUnloadedResponsiveImage,this).filter(this.isUntrackedImage,this);0!==t.length&&this._add(t)},a.prototype.load=function(e){o(e).filter(this._isUnloadedResponsiveImage,this).forEach(this._loadImage,this)},a}();a.DEBOUNCE_TIME=300;return new a});
//# sourceMappingURL=odo-responsive-images.min.js.map
