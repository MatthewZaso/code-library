{"version":3,"file":"odo-dropdown.js","sources":["../src/dropdown.js"],"sourcesContent":["import OdoDevice from '@odopod/odo-device';\nimport {\n  cancelTransitionEnd,\n  causeLayout,\n  giveId,\n  onTransitionEnd,\n} from '@odopod/odo-helpers';\nimport OdoBaseComponent from '@odopod/odo-base-component';\n\nlet id = 0;\nfunction uniqueId() {\n  id += 1;\n  return 'ododropdown-' + id;\n}\n\nclass Dropdown extends OdoBaseComponent {\n  constructor(element, options = {}) {\n    super(element);\n\n    /**\n     * Override any defaults with the given options.\n     * @type {Object}\n     */\n    this.options = Object.assign({}, Dropdown.Defaults, options);\n\n    /**\n     * Unique id for this instance.\n     * @type {string}\n     */\n    this.id = uniqueId();\n\n    /**\n     * Whether the dropdown is currently open.\n     * @type {boolean}\n     */\n    this._isOpen = false;\n\n    /**\n     * The <select> element.\n     * @type {HTMLSelectElement}\n     */\n    this._select = this.getElementByClass(Dropdown.Classes.SELECT);\n\n    // Give the select an id if it doesn't have one.\n    giveId(this._select, this.id);\n\n    /**\n     * The <label> for the <select>.\n     * @type {?HTMLLabelElement}\n     */\n    this._label = document.querySelector(`label[for=\"${this._select.id}\"]`);\n\n    // Generate the custom markup for options.\n    if (this.options.insertMarkup) {\n      this._insertMarkup();\n    }\n\n    // Save Element references.\n    this._optionsContainer = this.getElementByClass(Dropdown.Classes.OPTIONS_CONTAINER);\n    this._button = this.getElementByClass(Dropdown.Classes.BUTTON);\n    this._placeholder = this.getElementByClass(Dropdown.Classes.DEFAULT);\n    this._valueContainer = this.getElementByClass(Dropdown.Classes.VALUE);\n\n    // Set the selected option.\n    this._selectedOption = this._getCustomSelectedOption();\n\n    this._onSelectChange = this._handleSelectChange.bind(this);\n    this._onPageClick = this._handlePageClick.bind(this);\n    this._onButtonClick = this._showOptions.bind(this);\n    this._onKey = this._handleKey.bind(this);\n\n    this._transitionId = null;\n\n    this._initialize();\n  }\n\n  /**\n   * Determines whether to create custom dropdown module,\n   * or use native select element\n   */\n  _initialize() {\n    this._valueContainer.setAttribute('aria-hidden', true);\n\n    if (this.options.useNative) {\n      this._initializeNativeDropdown();\n    } else {\n      this._initializeCustomDropdown();\n    }\n  }\n\n  /**\n   * Return the selected custom option element.\n   * @return {Element}\n   */\n  _getCustomSelectedOption() {\n    return this.getCustomOptions()[this._select.selectedIndex];\n  }\n\n  /**\n   * Insert the custom option html markup before the <select> element.\n   */\n  _insertMarkup() {\n    const markup = this.getCustomOptionsHtml();\n    this._select.insertAdjacentHTML('beforebegin', markup);\n  }\n\n  /**\n   * Listen for change events on the <select>.\n   */\n  _initializeNativeDropdown() {\n    this.element.classList.add(Dropdown.Classes.BASE_NATIVE);\n    this._select.addEventListener('change', this._onSelectChange);\n\n    // Hide the <button> from the screen reader so that it only reads the\n    // <select> element. The <select> is actually positioned on top of the\n    // <button> with zero opacity.\n    this._button.setAttribute('aria-hidden', true);\n    this._button.tabIndex = -1;\n  }\n\n  /**\n   * Listen for clicks to trigger the menu and keyboard input.\n   */\n  _initializeCustomDropdown() {\n    if (this._label) {\n      giveId(this._label, this.id + '-label');\n      const { id } = this._label;\n      this._optionsContainer.setAttribute('aria-labelledby', id);\n    }\n\n    this._select.tabIndex = -1;\n    this._select.setAttribute('aria-hidden', true);\n    this._button.setAttribute('aria-haspopup', 'true');\n    this._button.setAttribute('aria-controls', this._select.id);\n    this._button.setAttribute('aria-expanded', false);\n\n    this._toggleButtonListener(true);\n    this.element.addEventListener('keydown', this._onKey);\n  }\n\n  /**\n   * Key down event occured.\n   * @param {KeyboardEvent} e Event object.\n   */\n  _handleKey(e) {\n    const code = e.which;\n\n    if (this._isOpen) {\n      switch (code) {\n        case Dropdown.Key.ESC:\n        case Dropdown.Key.TAB:\n          this._hideOptions();\n          break;\n\n        case Dropdown.Key.DOWN:\n        case Dropdown.Key.UP:\n          e.preventDefault();\n          Dropdown._moveFocus(code === Dropdown.Key.DOWN);\n          break;\n\n        case Dropdown.Key.SPACE:\n        case Dropdown.Key.ENTER:\n          e.preventDefault();\n          this._selectOption(e.target);\n          break;\n        // no default\n      }\n    } else {\n      switch (code) {\n        case Dropdown.Key.SPACE:\n        case Dropdown.Key.DOWN:\n        case Dropdown.Key.UP:\n        case Dropdown.Key.ENTER:\n          e.preventDefault();\n          this._showOptions();\n          break;\n        // no default\n      }\n    }\n  }\n\n  /**\n   * Transer focus from one option to the next or prev enabled option.\n   * @param {boolean} isNext Whether to focus on the next or previous option.\n   */\n  static _moveFocus(isNext) {\n    const selector = Dropdown.Selector.ENABLED_OPTION;\n    const enabledOption = isNext ?\n      Dropdown._nextMatch(document.activeElement, selector) :\n      Dropdown._prevMatch(document.activeElement, selector);\n\n    if (enabledOption) {\n      enabledOption.focus();\n    }\n  }\n\n  /**\n   * Find the next sibling which matches a selector.\n   * @param {Element} element Element to test.\n   * @param {string} selector Selector to match.\n   * @return {?Element} The element or null if there isn't one.\n   */\n  static _nextMatch(element, selector) {\n    while ((element = element.nextElementSibling)) { // eslint-disable-line\n      if (element.matches(selector)) {\n        return element;\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Find the previous sibling which matches a selector.\n   * @param {Element} element Element to test.\n   * @param {string} selector Selector to match.\n   * @return {?Element} The element or null if there isn't one.\n   */\n  static _prevMatch(element, selector) {\n    while ((element = element.previousElementSibling)) { // eslint-disable-line\n      if (element.matches(selector)) {\n        return element;\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Delegated click event on the document. Check to see if it was an option,\n   * otherwise hide the dropdown menu.\n   * @param {MouseEvent} e Event object.\n   */\n  _handlePageClick(e) {\n    const option = e.target.closest('.' + Dropdown.Classes.OPTION);\n    if (option) {\n      this._selectOption(option);\n    } else {\n      this._hideOptions();\n    }\n  }\n\n  /**\n   * Set the current value from an option element.\n   * @param {Element} option Custom option element.\n   */\n  _selectOption(option) {\n    // Avoid selecting disabled options or a target which is not an option (if\n    // the user rapidly presses space|enter, this method could be called with\n    // an event target which is not an option element because the transition\n    // hasn't finished).\n    if (option.classList.contains(Dropdown.Classes.OPTION_DISABLED) ||\n        !option.classList.contains(Dropdown.Classes.OPTION)) {\n      return;\n    }\n\n    const value = option.getAttribute('data-value');\n    this.value = value;\n    this._hideOptions();\n\n    // Emit event to notify watchers that this has changed.\n    this.emit(Dropdown.EventType.CHANGE, {\n      name: this.select.name,\n      value: this.value,\n    });\n  }\n\n  /**\n   * The native <select> input changed. Update the display.\n   */\n  _handleSelectChange() {\n    this.value = this._select.value;\n\n    // Emit event to notify watchers that this has changed.\n    this.emit(Dropdown.EventType.CHANGE, {\n      name: this.select.name,\n      value: this.value,\n    });\n  }\n\n  /**\n   * Add or remove click listener for custom select display element\n   * @params {boolean} add Whether to add or remove click listener\n   */\n  _toggleButtonListener(add) {\n    if (add) {\n      this._button.addEventListener('click', this._onButtonClick);\n    } else {\n      this._button.removeEventListener('click', this._onButtonClick);\n    }\n  }\n\n  /**\n   * Show the options dropdown menu.\n   */\n  _showOptions() {\n    this._isOpen = true;\n\n    // Clear any pending transition ends.\n    cancelTransitionEnd(this._transitionId);\n\n    // Remove click listener on button.\n    this._toggleButtonListener(false);\n\n    this.element.classList.add(Dropdown.Classes.OPEN);\n    this._optionsContainer.setAttribute('aria-hidden', false);\n    this._button.setAttribute('aria-expanded', true);\n    this._button.tabIndex = -1;\n    causeLayout(this._optionsContainer);\n    this._optionsContainer.classList.add(Dropdown.Classes.OPTIONS_CONTAINER_OPEN);\n    this._transitionId = onTransitionEnd(\n      this._optionsContainer,\n      this._handleOptionsShown, this,\n    );\n  }\n\n  /**\n   * Options dropdown finished show animation.\n   */\n  _handleOptionsShown() {\n    document.body.addEventListener('click', this._onPageClick);\n\n    // If all the options are disabled, a selected option doesn't exist.\n    if (this._selectedOption) {\n      this._selectedOption.focus();\n    }\n  }\n\n  /**\n   * Hide the options dropdown.\n   */\n  _hideOptions() {\n    this._isOpen = false;\n\n    // Clear any pending transition ends.\n    cancelTransitionEnd(this._transitionId);\n\n    document.body.removeEventListener('click', this._onPageClick);\n    this._optionsContainer.setAttribute('aria-hidden', true);\n    this._button.tabIndex = 0;\n    this._button.setAttribute('aria-expanded', false);\n    this._optionsContainer.classList.remove(Dropdown.Classes.OPTIONS_CONTAINER_OPEN);\n    this._transitionId = onTransitionEnd(\n      this._optionsContainer,\n      this._handleOptionsHidden, this,\n    );\n  }\n\n  /**\n   * Options dropdown finished hiding.\n   */\n  _handleOptionsHidden() {\n    this.element.classList.remove(Dropdown.Classes.OPEN);\n    this._button.focus();\n    this._toggleButtonListener(true);\n  }\n\n  /**\n   * Generate the HTML to show on non-touch devices.\n   * @return {string} A string of HTML.\n   * @protected\n   */\n  getCustomOptionsHtml() {\n    return `<div class=\"${Dropdown.Classes.OPTIONS_CONTAINER}\" role=\"menu\" aria-hidden=\"true\">` +\n      this.getOptionsMarkup() +\n      '</div>';\n  }\n\n  /**\n   * Generate an HTML string for custom options based on the current options\n   * in the <select>\n   * @return {string} Markup.\n   * @protected\n   */\n  getOptionsMarkup() {\n    return this.getNativeOptions().reduce((str, option) => str + this.getOptionMarkup(option), '');\n  }\n\n  /**\n   * Create an HTML string to be used for a custom option.\n   * @param {HTMLOptionElement} option Native option element.\n   * @return {string} Markup.\n   * @protected\n   */\n  getOptionMarkup(option) {\n    const selected = option.selected ? ' ' + Dropdown.Classes.OPTION_SELECTED : '';\n    const disabled = option.disabled ? ' ' + Dropdown.Classes.OPTION_DISABLED : '';\n    const className = Dropdown.Classes.OPTION + selected + disabled;\n    return `<div class=\"${className}\" data-value=\"${option.value}\" tabindex=\"-1\" role=\"menuitem\">` +\n      option.text + '</div>';\n  }\n\n  /**\n   * Return an array of custom option elements.\n   * @return {Array.<HTMLDivElement>}\n   */\n  getCustomOptions() {\n    return this.getElementsByClass(Dropdown.Classes.OPTION);\n  }\n\n  /**\n   * Return an array of option elements.\n   * @return {Array.<HTMLOptionElement>}\n   */\n  getNativeOptions() {\n    return Array.from(this.select.options);\n  }\n\n  /**\n   * Retrieve the text to display inside the button.\n   * @param {number} selectedIndex Index of the selected option.\n   * @return {string} Text to display.\n   * @protected\n   */\n  getDisplayText(selectedIndex) {\n    return this.select.options[selectedIndex].text;\n  }\n\n  /**\n   * Retrieve the selected index of the <select>\n   * @return {number}\n   */\n  get selectedIndex() {\n    return this._select.selectedIndex;\n  }\n\n  /**\n   * Set the selected option by index.\n   * @param {number} index Index to select.\n   */\n  set selectedIndex(index) {\n    this.value = this._select.options[index].value;\n  }\n\n  /**\n   * Returns the <select>.\n   * @return {HTMLSelectElement}\n   */\n  get select() {\n    return this._select;\n  }\n\n  /**\n   * Returns the button to open the select menu.\n   * @return {HTMLButtonElement}\n   */\n  get button() {\n    return this._button;\n  }\n\n  /**\n   * Return the display text for the currently selected option.\n   * @returns {string}\n   */\n  get selectedText() {\n    return this._select.options[this._select.selectedIndex].text;\n  }\n\n  /**\n   * Retrieve the selected value.\n   * @return {string}\n   */\n  get value() {\n    return this._select.value;\n  }\n\n  /**\n   * Set the value of the <select> and the custom menu.\n   * @param {string} value Value which matches one of the options.\n   */\n  set value(value) {\n    // Remove the old selected class.\n    if (this._selectedOption) {\n      this._selectedOption.classList.remove(Dropdown.Classes.OPTION_SELECTED);\n    }\n\n    // Set new value.\n    this._select.value = value;\n\n    // Update currently selected option.\n    this._selectedOption = this._getCustomSelectedOption();\n\n    if (this._selectedOption) {\n      // Read the text for the new value.\n      const text = this.getDisplayText(this.selectedIndex);\n\n      this._selectedOption.classList.add(Dropdown.Classes.OPTION_SELECTED);\n\n      // Update display.\n      this._placeholder.style.display = 'none';\n      this._placeholder.setAttribute('aria-hidden', true);\n      this._valueContainer.textContent = text;\n      this._valueContainer.removeAttribute('aria-hidden');\n    } else {\n      this._placeholder.style.display = '';\n      this._placeholder.removeAttribute('aria-hidden');\n      this._valueContainer.textContent = '';\n      this._valueContainer.setAttribute('aria-hidden', true);\n    }\n  }\n\n  /**\n   * Get the disabled state of the component.\n   * @return {boolean}\n   */\n  get disabled() {\n    return this.select.disabled;\n  }\n\n  /**\n   * Set the disabled state of the component.\n   * @param {boolean} isDisabled Whether it's disabled or not.\n   */\n  set disabled(isDisabled) {\n    this.select.disabled = isDisabled;\n    this.button.disabled = isDisabled;\n  }\n\n  /**\n   * Toggle the state of an option.\n   * @param {string} value Value of the option to toggle.\n   * @param {boolean} isDisabled Whether to disable it or not.\n   * @return {Dropdown} This instance for chaining.\n   */\n  toggleOptionByValue(value, isDisabled) {\n    const customOption = this._optionsContainer.querySelector(`[data-value=\"${value}\"]`);\n    const nativeOption = this._select.querySelector(`[value=\"${value}\"]`);\n\n    customOption.classList.toggle(Dropdown.Classes.OPTION_DISABLED, isDisabled);\n    if (isDisabled) {\n      customOption.setAttribute('aria-disabled', true);\n    } else {\n      customOption.removeAttribute('aria-disabled');\n    }\n\n    nativeOption.disabled = isDisabled;\n\n    return this;\n  }\n\n  /**\n   * Disable an option.\n   * @param {string} value Value of the option to disable.\n   * @return {Dropdown} This instance.\n   */\n  disableOptionByValue(value) {\n    return this.toggleOptionByValue(value, true);\n  }\n\n  /**\n   * Enable an option.\n   * @param {string} value Value of the option to enable.\n   * @return {Dropdown} This instance.\n   */\n  enableOptionByValue(value) {\n    return this.toggleOptionByValue(value, false);\n  }\n\n  dispose() {\n    this._select.removeEventListener('change', this._onSelectChange);\n    this._button.removeEventListener('click', this._onButtonClick);\n    document.body.removeEventListener('click', this._onPageClick);\n    this._optionsContainer.parentNode.removeChild(this._optionsContainer);\n\n    // Prefer resetting the tabIndex property by using removeAttribute to lets the\n    // browser decide if it should go back to 0 (like if it was a button) or to\n    // -1 if it wasn't originally focusable.\n    this._select.removeAttribute('tabindex');\n    this._select.removeAttribute('aria-hidden');\n    this._button.removeAttribute('tabindex');\n    this._button.removeAttribute('aria-hidden');\n    this._button.removeAttribute('aria-haspopup');\n    this._button.removeAttribute('aria-controls');\n    this._button.removeAttribute('aria-expanded');\n\n    this._selectedOption = null;\n    this._optionsContainer = null;\n    this._button = null;\n    this._placeholder = null;\n    this._valueContainer = null;\n    this._select = null;\n    super.dispose();\n  }\n}\n\nDropdown.Classes = {\n  BASE: 'odo-dropdown',\n  OPEN: 'odo-dropdown--open',\n  BUTTON: 'odo-dropdown__button',\n  OPTIONS_CONTAINER_OPEN: 'odo-dropdown__options--open',\n  OPTIONS_CONTAINER: 'odo-dropdown__options',\n  OPTION: 'odo-dropdown__option',\n  OPTION_SELECTED: 'odo-dropdown__option--active',\n  OPTION_DISABLED: 'odo-dropdown__option--disabled',\n  SELECT: 'odo-dropdown__select',\n  VALUE: 'odo-dropdown__value',\n  DEFAULT: 'odo-dropdown__default',\n  BASE_NATIVE: 'odo-dropdown--native',\n};\n\nDropdown.Key = {\n  TAB: 9,\n  ENTER: 13,\n  ESC: 27,\n  SPACE: 32,\n  UP: 38,\n  DOWN: 40,\n};\n\nDropdown.EventType = {\n  CHANGE: 'ododropdown:change',\n};\n\nDropdown.Selector = {\n  ENABLED_OPTION: `.${Dropdown.Classes.OPTION}:not(.${Dropdown.Classes.OPTION_DISABLED})`,\n};\n\nDropdown.Defaults = {\n  insertMarkup: true,\n  useNative: OdoDevice.HAS_TOUCH_EVENTS,\n};\n\nexport default Dropdown;\n"],"names":["id","uniqueId","Dropdown","element","options","Object","assign","Defaults","_isOpen","_select","getElementByClass","Classes","SELECT","giveId","_label","document","querySelector","insertMarkup","_insertMarkup","_optionsContainer","OPTIONS_CONTAINER","_button","BUTTON","_placeholder","DEFAULT","_valueContainer","VALUE","_selectedOption","_getCustomSelectedOption","_onSelectChange","_handleSelectChange","bind","_onPageClick","_handlePageClick","_onButtonClick","_showOptions","_onKey","_handleKey","_transitionId","_initialize","setAttribute","useNative","_initializeNativeDropdown","_initializeCustomDropdown","getCustomOptions","selectedIndex","markup","getCustomOptionsHtml","insertAdjacentHTML","classList","add","BASE_NATIVE","addEventListener","tabIndex","_toggleButtonListener","e","code","which","Key","ESC","TAB","_hideOptions","DOWN","UP","preventDefault","_moveFocus","SPACE","ENTER","_selectOption","target","isNext","selector","Selector","ENABLED_OPTION","enabledOption","_nextMatch","activeElement","_prevMatch","focus","nextElementSibling","matches","previousElementSibling","option","closest","OPTION","contains","OPTION_DISABLED","value","getAttribute","emit","EventType","CHANGE","name","select","removeEventListener","cancelTransitionEnd","OPEN","causeLayout","OPTIONS_CONTAINER_OPEN","onTransitionEnd","_handleOptionsShown","body","remove","_handleOptionsHidden","getOptionsMarkup","getNativeOptions","reduce","str","getOptionMarkup","selected","OPTION_SELECTED","disabled","className","text","getElementsByClass","Array","from","getDisplayText","toggleOptionByValue","isDisabled","customOption","nativeOption","toggle","removeAttribute","disableOptionByValue","enableOptionByValue","dispose","parentNode","removeChild","index","style","display","textContent","button","OdoBaseComponent","BASE","OdoDevice","HAS_TOUCH_EVENTS"],"mappings":"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"}