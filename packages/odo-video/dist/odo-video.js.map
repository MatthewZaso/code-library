{"version":3,"file":"odo-video.js","sources":["../src/settings.js","../src/support-test.js","../src/autoplay-test.js","../src/controls.js","../src/video.js"],"sourcesContent":["export default {\n  Classes: {\n    BASE: 'odo-video',\n\n    IS_PLAYING: 'odo-video--playing',\n    IS_FULLSCREEN: 'odo-video--fullscreen',\n    IS_MUTED: 'odo-video--muted',\n    IS_BUFFERING: 'odo-video--buffering',\n    IS_IDLE: 'odo-video--idle',\n    NO_FLEXBOX: 'odo-video--no-flexbox',\n    CONTROLS_STACKED: 'odo-video__controls--stacked',\n    CONTROLS_HIDDEN: 'odo-video__controls--hidden',\n\n    CONTROLS: 'odo-video__controls',\n    PLAY_TOGGLE: 'odo-video__play-toggle',\n    PLAY_CONTROL: 'odo-video__play-control',\n    PAUSE_CONTROL: 'odo-video__pause-control',\n    PROGRESS_CONTAINER: 'odo-video__progress-container',\n    PROGRESS_HOLDER: 'odo-video__progress-holder',\n    BUFFER: 'odo-video__buffer',\n    PROGRESS: 'odo-video__progress',\n    CURRENT_TIME: 'odo-video__current-time',\n    VOLUME: 'odo-video__volume',\n    MUTE_CONTROL: 'odo-video__mute-control',\n    UNMUTE_CONTROL: 'odo-video__unmute-control',\n    FULLSCREEN: 'odo-video__fullscreen',\n    FULLSCREEN_CONTROL: 'odo-video__fullscreen-control',\n    EXIT_FULLSCREEN_CONTROL: 'odo-video__exit-fullscreen-control',\n    FLEXIBLE_SPACE: 'odo-video__flexible-space',\n  },\n\n  Icons: {\n    FULLSCREEN: '<svg viewBox=\"0 0 16 16\" enable-background=\"new 0 0 16 16\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M12 2H8v2h2.586L8 6.587 9.414 8 12 5.415V8h2V2zM8 9.414L6.586 8 4 10.586V8H2v6h6v-2H5.415z\"/></svg>',\n    EXIT_FULLSCREEN: '<svg viewBox=\"0 0 16 16\" enable-background=\"new 0 0 16 16\"><path d=\"M15 2.4L13.6 1 11 3.6V1H9v6h6V5h-2.6L15 2.4zM5 9H1v2h2.6L1 13.6 2.4 15 5 12.4V15h2V9H5z\"/></svg>',\n    AUDIO_ON: '<svg viewBox=\"0 0 16 16\" enable-background=\"new 0 0 16 16\"><path d=\"M1 5.366v5.294c0 .177.142.32.317.32h2.89c.093 0 .18.034.254.093l4.505 3.743c.16.135.4.018.402-.19l.002-13.25c0-.21-.243-.325-.403-.193L4.47 4.923c-.077.064-.173.098-.27.098H1.33c-.235 0-.33.17-.33.346zm10.292-1.03c-.295-.296-.76-.296-1.057 0-.292.296-.292.775.002 1.07v-.002c.642.652 1.04 1.55 1.04 2.54 0 .992-.396 1.884-1.04 2.535-.294.295-.294.774 0 1.07.143.148.334.222.526.222.19 0 .388-.074.528-.22.91-.922 1.476-2.202 1.476-3.606 0-1.41-.567-2.69-1.476-3.61h.002zm1.71-1.732c-.294-.296-.76-.296-1.053 0-.294.296-.293.772 0 1.066 1.08 1.096 1.754 2.602 1.754 4.273s-.667 3.176-1.753 4.273c-.294.294-.294.77 0 1.067.142.146.337.222.53.222.19 0 .386-.076.526-.222 1.35-1.366 2.19-3.257 2.19-5.34-.008-2.08-.843-3.975-2.194-5.34z\"/></svg>',\n    AUDIO_OFF: '<svg viewBox=\"0 0 16 16\" enable-background=\"new 0 0 16 16\"><path d=\"M1 5.366v5.294c0 .177.142.32.317.32h2.89c.093 0 .18.034.254.093l4.505 3.743c.16.135.4.018.402-.19l.002-13.25c0-.21-.243-.325-.403-.193L4.47 4.923c-.077.064-.173.098-.27.098H1.33c-.235 0-.33.17-.33.346z\"/></svg>',\n  },\n\n  IDLE_TIMEOUT: 2000,\n\n  Defaults: {\n    controls: 1,\n    layoutControls: null,\n    updateControls: null,\n    pauseOnClick: true,\n  },\n\n  Controls: {\n    NONE: 0,\n    INLINE_PROGRESS: 1,\n    STACKED_PROGRESS: 2,\n    CUSTOM: 3,\n  },\n\n  VideoEvents: {\n    LOADED_METADATA: {\n      name: 'loadedmetadata',\n      readyState: 1,\n    },\n    LOADED_DATA: {\n      name: 'loadeddata',\n      readyState: 2,\n    },\n    CAN_PLAY: {\n      name: 'canplay',\n      readyState: 3,\n    },\n    CAN_PLAYTHROUGH: {\n      name: 'canplaythrough',\n      readyState: 4,\n    },\n  },\n};\n","// Determine support for videos. From Modernizr source.\n// https://github.com/Modernizr/Modernizr/blob/master/feature-detects/video.js\n\n// Codec values from : github.com/NielsLeenheer/html5test/blob/9106a8/index.html#L845\nexport default () => {\n  const elem = document.createElement('video');\n  let bool = !!elem.canPlayType;\n\n  // IE9 Running on Windows Server 2008 can cause an exception to be thrown, bug #224\n  // End of life for 'mainstream' WS2008 was 2015-1-13.\n  /* istanbul ignore next */\n  if (bool) {\n    bool = new Boolean(bool); // eslint-disable-line no-new-wrappers\n    bool.ogg = elem.canPlayType('video/ogg; codecs=\"theora\"');\n\n    // Without QuickTime, this value will be `undefined`. github.com/Modernizr/Modernizr/issues/546\n    bool.h264 = elem.canPlayType('video/mp4; codecs=\"avc1.42E01E\"');\n    bool.webm = elem.canPlayType('video/webm; codecs=\"vp8, vorbis\"');\n    bool.vp9 = elem.canPlayType('video/webm; codecs=\"vp9\"');\n    bool.hls = elem.canPlayType('application/x-mpegURL; codecs=\"avc1.42E01E\"');\n  }\n\n  return bool;\n};\n","function test(support) {\n  // If the test has already passed, return a resolved promise.\n  if (test.HAS_LOCAL_STORAGE && window.localStorage.getItem('odovideoautoplay') === 'true') {\n    return Promise.resolve(true);\n  }\n\n  // Retrieve the number of autoplay test attempts. Max is 3.\n  const tries = test.HAS_LOCAL_STORAGE && parseInt(window.localStorage.getItem('odovideoautoplaytries'), 10) || 0;\n  if (tries > 2) {\n    return Promise.resolve(false);\n  }\n\n  /* istanbul ignore next */\n  return new Promise((resolve) => {\n    let timeout;\n\n    // Chrome can handle 300ms. IE11 requires at least 900 to avoid failing consistenly.\n    const waitTime = 1000;\n    const elem = document.createElement('video');\n\n    const complete = (bool) => {\n      if (test.HAS_LOCAL_STORAGE) {\n        window.localStorage.setItem('odovideoautoplay', bool);\n        window.localStorage.setItem('odovideoautoplaytries', tries + 1);\n      }\n\n      resolve(bool);\n    };\n\n    const testAutoplay = (arg) => {\n      clearTimeout(timeout);\n      elem.removeEventListener('playing', testAutoplay);\n      complete(arg && arg.type === 'playing' || elem.currentTime !== 0);\n      elem.parentNode.removeChild(elem);\n    };\n\n    // Skip the test if video itself, or the autoplay element on it isn't supported.\n    if (!support || !('autoplay' in elem)) {\n      complete(false);\n      return;\n    }\n\n    // Starting with iOS 10, video[autoplay] videos must be on screen, visible\n    // through css, and inserted into the DOM.\n    // https://webkit.org/blog/6784/new-video-policies-for-ios/\n    elem.style.cssText = 'position:fixed;top:0;left:0;height:1px;width:1px;opacity:0;';\n    elem.src = 'data:video/mp4;base64,AAAAFGZ0eXBNU05WAAACAE1TTlYAAAOUbW9vdgAAAGxtdmhkAAAAAM9ghv7PYIb+AAACWAAACu8AAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAnh0cmFrAAAAXHRraGQAAAAHz2CG/s9ghv4AAAABAAAAAAAACu8AAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAFAAAAA4AAAAAAHgbWRpYQAAACBtZGhkAAAAAM9ghv7PYIb+AAALuAAANq8AAAAAAAAAIWhkbHIAAAAAbWhscnZpZGVBVlMgAAAAAAABAB4AAAABl21pbmYAAAAUdm1oZAAAAAAAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAVdzdGJsAAAAp3N0c2QAAAAAAAAAAQAAAJdhdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAFAAOABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAAEmNvbHJuY2xjAAEAAQABAAAAL2F2Y0MBTUAz/+EAGGdNQDOadCk/LgIgAAADACAAAAMA0eMGVAEABGjuPIAAAAAYc3R0cwAAAAAAAAABAAAADgAAA+gAAAAUc3RzcwAAAAAAAAABAAAAAQAAABxzdHNjAAAAAAAAAAEAAAABAAAADgAAAAEAAABMc3RzegAAAAAAAAAAAAAADgAAAE8AAAAOAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA4AAAAOAAAAFHN0Y28AAAAAAAAAAQAAA7AAAAA0dXVpZFVTTVQh0k/Ou4hpXPrJx0AAAAAcTVREVAABABIAAAAKVcQAAAAAAAEAAAAAAAAAqHV1aWRVU01UIdJPzruIaVz6ycdAAAAAkE1URFQABAAMAAAAC1XEAAACHAAeAAAABBXHAAEAQQBWAFMAIABNAGUAZABpAGEAAAAqAAAAASoOAAEAZABlAHQAZQBjAHQAXwBhAHUAdABvAHAAbABhAHkAAAAyAAAAA1XEAAEAMgAwADAANQBtAGUALwAwADcALwAwADYAMAA2ACAAMwA6ADUAOgAwAAABA21kYXQAAAAYZ01AM5p0KT8uAiAAAAMAIAAAAwDR4wZUAAAABGjuPIAAAAAnZYiAIAAR//eBLT+oL1eA2Nlb/edvwWZflzEVLlhlXtJvSAEGRA3ZAAAACkGaAQCyJ/8AFBAAAAAJQZoCATP/AOmBAAAACUGaAwGz/wDpgAAAAAlBmgQCM/8A6YEAAAAJQZoFArP/AOmBAAAACUGaBgMz/wDpgQAAAAlBmgcDs/8A6YEAAAAJQZoIBDP/AOmAAAAACUGaCQSz/wDpgAAAAAlBmgoFM/8A6YEAAAAJQZoLBbP/AOmAAAAACkGaDAYyJ/8AFBAAAAAKQZoNBrIv/4cMeQ==';\n\n    elem.setAttribute('autoplay', '');\n    elem.setAttribute('muted', '');\n    elem.setAttribute('playsinline', '');\n    document.documentElement.appendChild(elem);\n\n    // Wait for the next tick to add the listener, otherwise the element may\n    // not have time to play in high load situations (e.g. the test suite).\n    setTimeout(() => {\n      elem.addEventListener('playing', testAutoplay);\n      timeout = setTimeout(testAutoplay, waitTime);\n    }, 0);\n  });\n}\n\n// Support: Safari private browsing.\ntest.HAS_LOCAL_STORAGE = (() => {\n  try {\n    const testKey = 'test';\n    window.localStorage.setItem(testKey, '1');\n    window.localStorage.removeItem(testKey);\n    return true;\n  } catch (error) /* istanbul ignore next */ {\n    return false;\n  }\n})();\n\nexport default test;\n","import settings from './settings';\n\nclass Controls {\n  createElement(type, options) {\n    const el = document.createElement(type);\n    Object.keys(options).forEach((k) => {\n      el[k] = options[k];\n    });\n\n    return el;\n  }\n\n  createElements() {\n    return {\n      controls: this.createElement('div', {\n        className: settings.Classes.CONTROLS,\n      }),\n      playToggle: this.createElement('button', {\n        className: settings.Classes.PLAY_TOGGLE,\n        title: Controls.LABEL.PLAY_TOGGLE,\n      }),\n      playControl: this.createElement('span', {\n        className: settings.Classes.PLAY_CONTROL,\n      }),\n      pauseControl: this.createElement('span', {\n        className: settings.Classes.PAUSE_CONTROL,\n      }),\n      progressContainer: this.createElement('div', {\n        className: settings.Classes.PROGRESS_CONTAINER,\n      }),\n      progressHolder: this.createElement('div', {\n        className: settings.Classes.PROGRESS_HOLDER,\n      }),\n      buffer: this.createElement('div', {\n        className: settings.Classes.BUFFER,\n      }),\n      progress: this.createElement('div', {\n        className: settings.Classes.PROGRESS,\n      }),\n      currentTime: this.createElement('div', {\n        className: settings.Classes.CURRENT_TIME,\n      }),\n      volumeToggle: this.createElement('button', {\n        className: settings.Classes.VOLUME,\n        title: Controls.LABEL.VOLUME,\n      }),\n      muteControl: this.createElement('span', {\n        className: settings.Classes.MUTE_CONTROL,\n        innerHTML: settings.Icons.AUDIO_ON,\n      }),\n      unmuteControl: this.createElement('span', {\n        className: settings.Classes.UNMUTE_CONTROL,\n        innerHTML: settings.Icons.AUDIO_OFF,\n      }),\n      fullScreenToggle: this.createElement('button', {\n        className: settings.Classes.FULLSCREEN,\n        title: Controls.LABEL.FULLSCREEN,\n      }),\n      enterFullscreen: this.createElement('span', {\n        className: settings.Classes.FULLSCREEN_CONTROL,\n        innerHTML: settings.Icons.FULLSCREEN,\n      }),\n      exitFullscreen: this.createElement('span', {\n        className: settings.Classes.EXIT_FULLSCREEN_CONTROL,\n        innerHTML: settings.Icons.EXIT_FULLSCREEN,\n      }),\n      flexibleSpace: this.createElement('div', {\n        className: settings.Classes.FLEXIBLE_SPACE,\n      }),\n    };\n  }\n\n  create(style, customFn) {\n    const elements = this.createElements();\n\n    elements.playToggle.appendChild(elements.playControl);\n    elements.playToggle.appendChild(elements.pauseControl);\n\n    elements.volumeToggle.appendChild(elements.muteControl);\n    elements.volumeToggle.appendChild(elements.unmuteControl);\n\n    elements.fullScreenToggle.appendChild(elements.enterFullscreen);\n    elements.fullScreenToggle.appendChild(elements.exitFullscreen);\n\n    elements.progressHolder.appendChild(elements.buffer);\n    elements.progressHolder.appendChild(elements.progress);\n    elements.progressContainer.appendChild(elements.progressHolder);\n\n    switch (style) {\n      case settings.Controls.INLINE_PROGRESS:\n        this._createInline(elements);\n        break;\n      case settings.Controls.NONE:\n\n        // When no controls are specified, create them anyways. It's easier to hide\n        // the controls and still have them in the DOM than it is to many if-statements\n        // checking if the controls exist before modifying them.\n        this._createInline(elements);\n        elements.controls.classList.add(settings.Classes.CONTROLS_HIDDEN);\n        break;\n      case settings.Controls.STACKED_PROGRESS:\n        this._createStacked(elements);\n        break;\n      case settings.Controls.CUSTOM:\n        customFn(elements);\n        break;\n      // no default\n    }\n\n    return elements.controls;\n  }\n\n  _createInline(elements) {\n    elements.controls.appendChild(elements.playToggle);\n    elements.controls.appendChild(elements.progressContainer);\n    elements.controls.appendChild(elements.currentTime);\n    elements.controls.appendChild(elements.volumeToggle);\n    elements.controls.appendChild(elements.fullScreenToggle);\n  }\n\n  _createStacked(elements) {\n    elements.controls.appendChild(elements.progressContainer);\n    elements.controls.appendChild(elements.playToggle);\n    elements.controls.appendChild(elements.flexibleSpace);\n    elements.controls.appendChild(elements.currentTime);\n    elements.controls.appendChild(elements.volumeToggle);\n    elements.controls.appendChild(elements.fullScreenToggle);\n    elements.controls.classList.add(settings.Classes.CONTROLS_STACKED);\n  }\n}\n\nControls.LABEL = {\n  PLAY_TOGGLE: 'toggle video playback.',\n  VOLUME: 'toggle mute for video.',\n  FULLSCREEN: 'toggle video fullscreen mode.',\n};\n\nexport default Controls;\n","import screenfull from 'screenfull';\nimport settings from './settings';\nimport supportTest from './support-test';\nimport autoplayTest from './autoplay-test';\nimport Controls from './controls';\n\n/**\n * Features:\n *\n * Autoplay support callbacks.\n * Skinnable UI controls.\n * Fullscreen mode.\n * Click-to-seek.\n * Preload video.\n * Dynamically update source.\n * Hide controls & mouse in fullscreen when idle.\n * Spacebar pauses video in fullscreen mode.\n * Function to define control structure.\n * Callback for updating controls on video progress.\n */\nclass Video {\n  constructor(element, options) {\n    /**\n     * @type {Element}\n     */\n    this.element = element;\n\n    /**\n     * @type {HTMLVideoElement}\n     */\n    this.videoEl = this._findVideoElement();\n\n    /**\n     * Random id for this instance.\n     */\n    this.id = Math.random().toString(36).substring(7);\n\n    /**\n     * Options for this instance.\n     * @type {object}\n     */\n    this.options = Object.assign({}, Video.Defaults, options);\n\n    this.isPlaying = this._isPlaying();\n    this.isFullscreen = false;\n    this._idleTimeout = null;\n\n    /**\n     * Whether the browser can go in fullscreen mode. This will be true for iOS\n     * because the video element can go fullscreen, but false for IE<11.\n     * @private {boolean}\n     */\n    this._noFullscreen = false;\n\n    this.element.classList.toggle(Video.Classes.NO_FLEXBOX, Video.NO_FLEXBOX);\n\n    // Set id attributes for each source.\n    this._setSourceIds();\n    this._createControls();\n    this._saveElements();\n    this.bindEvents();\n\n    if (this._isMetadataLoaded()) {\n      this._setProgressDisplay();\n      this._setBufferDisplay();\n    }\n\n    this.autoplay = Promise.resolve(Video.autoplay);\n  }\n\n  /**\n   * Bind the correct `this` context to each event listener. The native `bind`\n   * method returns a different function each time `bind` is called, so the value\n   * must be saved in order to remove the correct listener.\n   * @protected\n   */\n  _bindListeners() {\n    this._onMetadataLoaded = this._handleMetadataLoaded.bind(this);\n    this._onClick = this._handleClick.bind(this);\n    this._onPlay = this._handlePlaying.bind(this);\n    this._onPause = this._handlePaused.bind(this);\n    this._onTimeUpdate = this._handleTimeUpdate.bind(this);\n    this._onProgress = this._handleProgress.bind(this);\n    this._onFullscreenToggle = this.toggleFullscreen.bind(this);\n    this._onFullscreenChange = this._fullscreenChanged.bind(this);\n    this._onVolumeToggle = this.toggleVolume.bind(this);\n    this._onProgressClick = this._handleProgressClick.bind(this);\n    this._onSeeking = this._handleSeeking.bind(this);\n    this._onSeeked = this._handleSeeked.bind(this);\n    this._onMouseMove = this._returnFromIdle.bind(this);\n    this._onIdleTimeout = this._wentIdle.bind(this);\n    this._onKeyboardPlaybackToggle = this._handleKeyboardPlaybackToggle.bind(this);\n  }\n\n  /**\n   * Add event listeners to the video and UI elements.\n   * @protected\n   */\n  bindEvents() {\n    this._bindListeners();\n    this._waitForMetadata();\n\n    if (this.options.pauseOnClick) {\n      this.videoEl.addEventListener('click', this._onClick);\n    }\n\n    // Sent when playback is paused.\n    this.videoEl.addEventListener('pause', this._onPause);\n\n    // Sent when the media begins to play (either for the first time, after having\n    // been paused, or after ending and then restarting).\n    this.videoEl.addEventListener('playing', this._onPlay);\n    this.videoEl.addEventListener('timeupdate', this._onTimeUpdate);\n    this.videoEl.addEventListener('progress', this._onProgress);\n    // this.videoEl.addEventListener('volumechange', this._onVolumeChange);\n    this.videoEl.addEventListener('seeking', this._onSeeking);\n    this.videoEl.addEventListener('seeked', this._onSeeked);\n\n    this.getElementByClass(Video.Classes.PLAY_TOGGLE)\n      .addEventListener('click', this._onClick);\n    this.getElementByClass(Video.Classes.VOLUME)\n      .addEventListener('click', this._onVolumeToggle);\n    this.getElementByClass(Video.Classes.PROGRESS_HOLDER)\n      .addEventListener('click', this._onProgressClick);\n    this.getElementByClass(Video.Classes.FULLSCREEN)\n      .addEventListener('click', this._onFullscreenToggle);\n\n    if (Video.screenfull.enabled) {\n      document.addEventListener(\n        Video.screenfull.raw.fullscreenchange,\n        this._onFullscreenChange,\n      );\n      document.addEventListener(\n        Video.screenfull.raw.fullscreenerror,\n        this._onFullscreenChange,\n      );\n\n      // iOS handles full screen differently.\n    } else if (this.videoEl.webkitSupportsFullscreen) {\n      this.videoEl.addEventListener('webkitbeginfullscreen', this._onFullscreenChange);\n      this.videoEl.addEventListener('webkitendfullscreen', this._onFullscreenChange);\n    } else {\n      this._noFullscreen = true;\n    }\n  }\n\n  /**\n   * Checks the network state of the video element. Returns true if the metadata\n   * for the video is present.\n   * @return {boolean}\n   * @private\n   */\n  _isMetadataLoaded() {\n    return this.videoEl.readyState > 0;\n  }\n\n  /**\n   * Add the `loadedmetadata` event listener if the video has not loaded yet, or\n   * call the event handler directly if it has.\n   * @private\n   */\n  _waitForMetadata() {\n    if (this._isMetadataLoaded()) {\n      this._handleMetadataLoaded();\n    } else {\n      this.videoEl.addEventListener('loadedmetadata', this._onMetadataLoaded);\n    }\n  }\n\n  /**\n   * Save references to UI elements which needs to be constantly updated.\n   * @protected\n   */\n  _saveElements() {\n    this.currentTimeEl = this.getElementByClass(Video.Classes.CURRENT_TIME);\n    this.progressEl = this.getElementByClass(Video.Classes.PROGRESS);\n    this.bufferEl = this.getElementByClass(Video.Classes.BUFFER);\n  }\n\n  /**\n   * Separated into its own function so sinon can stub it in the tests.\n   * @return {HTMLVideoElement}\n   * @private\n   */\n  _findVideoElement() {\n    return this.element.getElementsByTagName('video')[0];\n  }\n\n  /**\n   * Whether the video is currently playing.\n   * @return {boolean}\n   */\n  _isPlaying() {\n    if (this.videoEl.ended || this.videoEl.paused) {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * For each <source> element, set a unique id on it.\n   * @private\n   */\n  _setSourceIds() {\n    this.getSourceElements().forEach((source) => {\n      source.id = this.id + source.type.split('/')[1];\n    });\n  }\n\n  /**\n   * Retrieve all <source> elements within the video.\n   * @return {Array.<HTMLSourceElement>}\n   */\n  getSourceElements() {\n    return Array.from(this.videoEl.getElementsByTagName('source'));\n  }\n\n  /**\n   * Return the main element this component was instantiated with.\n   * @return {Element}\n   */\n  getElement() {\n    return this.element;\n  }\n\n  /**\n   * Returns the <video> element associated with this component.\n   * @return {HTMLVideoElement}\n   */\n  getVideoElement() {\n    return this.videoEl;\n  }\n\n  /**\n   * Retrieve an element from within the main element by a class name.\n   * @param {string} className Class name to search for.\n   * @return {?Element} The element or null if it isn't found.\n   */\n  getElementByClass(className) {\n    return this.element.getElementsByClassName(className)[0];\n  }\n\n  /**\n   * Play the current video.\n   * https://googlechrome.github.io/samples/play-return-promise/\n   * @return {?Promise<void>} Chrome 50+, Firefox 53+, and Safari 10+ return a\n   *     promise which is rejected if the device cannot autoplay.\n   */\n  play() {\n    return this.videoEl.play();\n  }\n\n  /**\n   * Pause the currently playing video.\n   */\n  pause() {\n    this.videoEl.pause();\n  }\n\n  /**\n   * If playing, pause. If paused, play.\n   */\n  togglePlayback() {\n    if (this.isPlaying) {\n      this.pause();\n    } else {\n      this.play();\n    }\n  }\n\n  /**\n   * Get the current time, in seconds.\n   * @return {number}\n   */\n  getCurrentTime() {\n    return this.videoEl.currentTime;\n  }\n\n  /**\n   * Go to a specified time in the video.\n   * @param {number} time Time in seconds.\n   */\n  setCurrentTime(time) {\n    this.videoEl.currentTime = time;\n  }\n\n  /**\n   * Mute the video.\n   */\n  mute() {\n    this.videoEl.volume = 0;\n    this.element.classList.add(Video.Classes.IS_MUTED);\n  }\n\n  /**\n   * Unmute the video.\n   */\n  unmute() {\n    this.videoEl.volume = 1;\n    this.element.classList.remove(Video.Classes.IS_MUTED);\n  }\n\n  /**\n   * Whether the video is currently muted.\n   * @return {boolean}\n   */\n  isMuted() {\n    return this.videoEl.volume === 0;\n  }\n\n  /**\n   * Mute the video if it's playing audio or unmute it if it's already muted.\n   */\n  toggleVolume() {\n    if (this.isMuted()) {\n      this.unmute();\n    } else {\n      this.mute();\n    }\n  }\n\n  /**\n   * Update the current video source. This method changes the appropriate <source>\n   * `src` property.\n   *\n   * IE9 does not work when the <video>s `src` property or attribute is updated.\n   *\n   * @param {string} src Absolute or relative path to the video, without the extension.\n   *     e.g. \"/videos/cool-feature\".\n   */\n  updateSource(src) {\n    const { extension } = Video.getVideoType();\n    const sources = this.getSourceElements();\n\n    // Find the <source> element by Id.\n    const source = sources.filter(source => source.id === this.id + extension)[0];\n\n    const videoSource = src + '.' + extension;\n\n    // Update the source's src.\n    source.setAttribute('src', videoSource);\n\n    this.videoEl.load();\n\n    // Reset progress bars.\n    this._setProgressDisplay();\n    this._setBufferDisplay();\n\n    // When metadata loads, update the times.\n    this._waitForMetadata();\n  }\n\n  /**\n   * Show the video is currently buffering.\n   * @protected\n   */\n  showBuffering() {\n    this.element.classList.add(Video.Classes.IS_BUFFERING);\n  }\n\n  /**\n   * Show the video is done buffering.\n   * @protected\n   */\n  hideBuffering() {\n    this.element.classList.remove(Video.Classes.IS_BUFFERING);\n  }\n\n  /**\n   * Converts a time value to MMSS, so 91 seconds is \"1:31\".\n   * @param {number} currentTime Time in seconds.\n   * @return {string} Human readable time.\n   */\n  static getPrettyTime(currentTime) {\n    const hours = Math.floor(currentTime / 3600);\n    const minutes = Math.floor((currentTime - (hours * 3600)) / 60);\n    let seconds = currentTime - (hours * 3600) - (minutes * 60);\n\n    if (seconds < 10) {\n      seconds = '0' + seconds;\n    }\n\n    let time = minutes + ':' + seconds;\n    if (hours > 0) {\n      if (minutes < 10) {\n        time = '0' + time;\n      }\n\n      time = hours + ':' + time;\n    }\n\n    return time;\n  }\n\n  /**\n   * Generate the controls elemenet and append it to the main element.\n   * @private\n   */\n  _createControls() {\n    const controls = new Video.ControlsCreator();\n    const mainElement = controls.create(this.options.controls, this.options.layoutControls);\n    this.element.appendChild(mainElement);\n  }\n\n  /**\n   * Update the controls state/display with the new current time.\n   * @private\n   */\n  _updateControls() {\n    const seconds = this.getCurrentTime();\n    this._setCurrentTimeDisplay(seconds);\n    this._setProgressDisplay();\n\n    // Give a hook to update custom controls.\n    if (this.options.updateControls) {\n      this.options.updateControls(seconds);\n    }\n  }\n\n  /**\n   * Sets the current time element's text to a pretty time given a float.\n   * @param {number} seconds The current time of the video.\n   */\n  _setCurrentTimeDisplay(seconds) {\n    this.currentTimeEl.textContent = Video.getPrettyTime(Math.round(seconds));\n  }\n\n  /**\n   * Set the progress elements to a percentage.\n   * @param {number} percentage Number between 0 and 1. If undefined, the percentage\n   *     will be calculated from the video's current time and duration.\n   * @private\n   */\n  _setProgressDisplay(percentage = this.videoEl.currentTime / this.videoEl.duration) {\n    this.progressEl.style.width = percentage * 100 + '%';\n  }\n\n  /**\n   * Determine the amount the video has buffered and set the buffer element's width\n   * as that percentage.\n   * @private\n   */\n  _setBufferDisplay() {\n    // Progress events can be emitted before there is anything buffered.\n    const percentage = this.videoEl.buffered.length > 0 ?\n      this.videoEl.buffered.end(0) / this.videoEl.duration :\n      0;\n\n    this.bufferEl.style.width = percentage * 100 + '%';\n  }\n\n  /**\n   * Clicked the fullscreen icon. Request or exit from fullscreen.\n   */\n  toggleFullscreen() {\n    if (Video.screenfull) {\n      // Handle it the standardized way.\n      Video.screenfull.toggle(this.element);\n    } else if (this._noFullscreen) {\n      // Support: IE<11. Since there won't be any entered/exited fullscreen events,\n      // that callback must be invoked immediately.\n      this._fullscreenChanged();\n    } else {\n      // Since the native video controls will be shown and not the Video\n      // custom controls, it can be assumed that this event handler will only\n      // be triggered by requesting fullscreen.\n      this.videoEl.webkitEnterFullscreen();\n    }\n  }\n\n  /**\n   * Event handler for both fullscreenchange and fullscreenerror. The state of\n   * fullscreen has changed and styles need to be updated.\n   * @private\n   */\n  _fullscreenChanged() {\n    this.isFullscreen = !this.isFullscreen;\n    this._toggleFullscreenState();\n  }\n\n  _toggleFullscreenState() {\n    this.element.classList.toggle(Video.Classes.IS_FULLSCREEN, this.isFullscreen);\n\n    if (this.isFullscreen) {\n      this._startIdleTimer();\n\n      // Take focus off the fullscreen button because the spacebar should pause\n      // the video, but when it's focused, it will exit fullscreen.\n      document.activeElement.blur();\n      this.element.focus();\n      this.element.addEventListener('mousemove', this._onMouseMove);\n\n      // Use keyup instead of keypress because special keys (control, shift, alt, etc.)\n      // do not trigger the keypress event.\n      document.addEventListener('keyup', this._onKeyboardPlaybackToggle);\n    } else {\n      this._returnFromIdle();\n\n      // Return from idle starts a new timer, which isn't wanted when closing fullscreen.\n      clearTimeout(this._idleTimeout);\n      this.element.removeEventListener('mousemove', this._onMouseMove);\n      document.removeEventListener('keyup', this._onKeyboardPlaybackToggle);\n    }\n  }\n\n  /**\n   * When the user stops interacting with the page, the cursor should disappear and\n   * the controls should be hidden.\n   * @private\n   */\n  _wentIdle() {\n    this.element.classList.add(Video.Classes.IS_IDLE);\n  }\n\n  /**\n   * When returning from the idle state, the cursor and controls should be shown.\n   * Another timer is started to wait for idle state again.\n   * @private\n   */\n  _returnFromIdle() {\n    clearTimeout(this._idleTimeout);\n    this._startIdleTimer();\n    this.element.classList.remove(Video.Classes.IS_IDLE);\n  }\n\n  /**\n   * Sets a timeout which will trigger the `wentIdle` method when it expires.\n   * @private\n   */\n  _startIdleTimer() {\n    this._idleTimeout = setTimeout(this._onIdleTimeout, Video.IDLE_TIMEOUT);\n  }\n\n  /**\n   * Calculate the position of the click relative to the element the click listener\n   * was bound to.\n   * @param {MouseEvent} event Event object.\n   * @return {{x: number, y: number}}\n   * @private\n   */\n  static _getClickOffset(event) {\n    if ('offsetX' in event) {\n      return {\n        x: event.offsetX,\n        y: event.offsetY,\n      };\n    }\n\n    const rect = event.currentTarget.getBoundingClientRect();\n    return {\n      x: event.clientX - rect.left,\n      y: event.clientY - rect.top,\n    };\n  }\n\n  /**\n   * Event handler for the `loadedmetadata` event. Update UI with new data.\n   * @private\n   */\n  _handleMetadataLoaded() {\n    this.videoEl.removeEventListener('loadedmetadata', this._onMetadataLoaded);\n    this._setCurrentTimeDisplay(this.videoEl.duration);\n  }\n\n  /**\n   * Clicked on the main element. Toggle video playback.\n   */\n  _handleClick() {\n    this.togglePlayback();\n  }\n\n  /**\n   * Event handler for the `playing` event. Add the is-playing class.\n   * @private\n   */\n  _handlePlaying() {\n    this.isPlaying = true;\n    this.element.classList.toggle(Video.Classes.IS_PLAYING, this.isPlaying);\n  }\n\n  /**\n   * Event handler for the `paused` event. Remove the is-playing class.\n   * @private\n   */\n  _handlePaused() {\n    this.isPlaying = false;\n    this.element.classList.toggle(Video.Classes.IS_PLAYING, this.isPlaying);\n  }\n\n  /**\n   * Event handler for the `timeupdate` event. Update the UI.\n   * @private\n   */\n  _handleTimeUpdate() {\n    this._updateControls();\n  }\n\n  /**\n   * Event handler for the `progress` event. Update the buffer display bar.\n   * @private\n   */\n  _handleProgress() {\n    this._setBufferDisplay();\n  }\n\n  /**\n   * Clicked the progress bar track. Seek to the location of the click.\n   * @param {MouseEvent} evt Event object.\n   * @private\n   */\n  _handleProgressClick(evt) {\n    const offset = Video._getClickOffset(evt);\n    const width = evt.currentTarget.offsetWidth;\n    const percent = offset.x / width;\n    this._setProgressDisplay(percent);\n    this.setCurrentTime(percent * this.videoEl.duration);\n  }\n\n  /**\n   * Video started seeking. Show the user it's buffering.\n   * @private\n   */\n  _handleSeeking() {\n    // Avoid adding the buffering class when the video is looping - issue #1\n    if (this.videoEl.buffered.length === 0 ||\n        this.videoEl.buffered.end(0) < this.videoEl.currentTime) {\n      this.showBuffering();\n    }\n  }\n\n  /**\n   * Video stopped seeking. Show the user it's ready to play.\n   * @private\n   */\n  _handleSeeked() {\n    this.hideBuffering();\n  }\n\n  /**\n   * If the spacebar is pressed, toggle playback.\n   * @param {KeyboardEvent} evt Event object.\n   * @private\n   */\n  _handleKeyboardPlaybackToggle(evt) {\n    // Trigger the controls to show again.\n    this._returnFromIdle();\n\n    // Spacebar.\n    if (Video._getWhichKey(evt) === 32) {\n      this.togglePlayback();\n      evt.preventDefault();\n    }\n  }\n\n  /**\n   * Crossbrowser way to get the key which was pressed in a keyboard event.\n   * @param {KeyboardEvent} event Event object.\n   * @return {number}\n   * @private\n   */\n  static _getWhichKey(event) {\n    if (event.which) {\n      return event.which;\n    }\n    return event.charCode || event.keyCode;\n  }\n\n  /**\n   * Handler for triggering events on readyState or video data events\n   * @param {Object} event Object containing event name and readyState.\n   * @param {function():void} cb Callback function for event.\n   * @public\n   */\n  listenOnData(event, cb) {\n    let loaded;\n    if (this.videoEl.readyState > event.readyState) {\n      cb();\n    } else {\n      this.videoEl.addEventListener(event.name, loaded = () => {\n        this.videoEl.removeEventListener(event.name, loaded);\n        cb();\n      });\n    }\n  }\n\n  /**\n   * Remove all event listeners, references to DOM elements, and generated elements.\n   */\n  dispose() {\n    this.videoEl.removeEventListener('click', this._onClick);\n    this.videoEl.removeEventListener('pause', this._onPause);\n    this.videoEl.removeEventListener('playing', this._onPlay);\n    this.videoEl.removeEventListener('timeupdate', this._onTimeUpdate);\n    this.videoEl.removeEventListener('progress', this._onProgress);\n    this.videoEl.removeEventListener('seeking', this._onSeeking);\n    this.videoEl.removeEventListener('seeked', this._onSeeked);\n    this.videoEl.removeEventListener('loadedmetadata', this._onMetadataLoaded);\n\n    this.getElementByClass(Video.Classes.PLAY_TOGGLE)\n      .removeEventListener('click', this._onClick);\n    this.getElementByClass(Video.Classes.VOLUME)\n      .removeEventListener('click', this._onVolumeToggle);\n    this.getElementByClass(Video.Classes.PROGRESS_HOLDER)\n      .removeEventListener('click', this._onProgressClick);\n    this.getElementByClass(Video.Classes.FULLSCREEN)\n      .removeEventListener('click', this._onFullscreenToggle);\n\n    const fullscreenChange = this._onFullscreenChange;\n    if (Video.screenfull.enabled) {\n      document.removeEventListener(Video.screenfull.raw.fullscreenchange, fullscreenChange);\n      document.removeEventListener(Video.screenfull.raw.fullscreenerror, fullscreenChange);\n    } else if (this.videoEl.webkitSupportsFullscreen) {\n      this.videoEl.removeEventListener('webkitbeginfullscreen', fullscreenChange);\n      this.videoEl.removeEventListener('webkitendfullscreen', fullscreenChange);\n    }\n\n    this.element.removeChild(this.getElementByClass(Video.Classes.CONTROLS));\n\n    this.currentTimeEl = null;\n    this.progressEl = null;\n    this.bufferEl = null;\n    this.element = null;\n    this.videoEl = null;\n  }\n\n  /**\n   * Get the media type and extension for the currently supported video types.\n   * @return {{extension: string, type: string}}\n   */\n  static getVideoType() {\n    // Webm is best.\n    if (Video.support.webm) {\n      return {\n        extension: 'webm',\n        type: 'video/webm',\n      };\n    }\n\n    return {\n      extension: 'mp4',\n      type: 'video/mp4',\n    };\n  }\n}\n\n/* Merge in settings */\nObject.assign(Video, settings);\n\n/**\n * Determine support for videos. It is a boolean value with properties for\n * h264, webm, vp9, ogg, hls.\n * @type {Boolean}\n */\nVideo.support = supportTest();\n\n/**\n * An async test for autoplay feature.\n * @type {Promise}\n */\nVideo.autoplay = autoplayTest(Video.support);\nVideo._autoplayTest = autoplayTest;\n\n/** @type {Controls} */\nVideo.ControlsCreator = Controls;\n\n/** @type {boolean} IE9 is the only supported browser without flexbox. */\n/* istanbul ignore next */\nVideo.NO_FLEXBOX = document.all && document.addEventListener && !window.atob;\n\n/** @type {boolean|Object} Expose for testing. */\nVideo.screenfull = screenfull;\n\nexport default Video;\n"],"names":["Classes","BASE","IS_PLAYING","IS_FULLSCREEN","IS_MUTED","IS_BUFFERING","IS_IDLE","NO_FLEXBOX","CONTROLS_STACKED","CONTROLS_HIDDEN","CONTROLS","PLAY_TOGGLE","PLAY_CONTROL","PAUSE_CONTROL","PROGRESS_CONTAINER","PROGRESS_HOLDER","BUFFER","PROGRESS","CURRENT_TIME","VOLUME","MUTE_CONTROL","UNMUTE_CONTROL","FULLSCREEN","FULLSCREEN_CONTROL","EXIT_FULLSCREEN_CONTROL","FLEXIBLE_SPACE","Icons","EXIT_FULLSCREEN","AUDIO_ON","AUDIO_OFF","IDLE_TIMEOUT","Defaults","controls","layoutControls","updateControls","pauseOnClick","Controls","NONE","INLINE_PROGRESS","STACKED_PROGRESS","CUSTOM","VideoEvents","LOADED_METADATA","name","readyState","LOADED_DATA","CAN_PLAY","CAN_PLAYTHROUGH","elem","document","createElement","bool","canPlayType","Boolean","ogg","h264","webm","vp9","hls","test","support","HAS_LOCAL_STORAGE","window","localStorage","getItem","Promise","resolve","tries","parseInt","timeout","waitTime","complete","setItem","testAutoplay","arg","clearTimeout","removeEventListener","type","currentTime","parentNode","removeChild","style","cssText","src","setAttribute","documentElement","appendChild","setTimeout","addEventListener","testKey","removeItem","error","options","el","Object","keys","forEach","k","createElements","className","settings","playToggle","title","LABEL","playControl","pauseControl","progressContainer","progressHolder","buffer","progress","volumeToggle","muteControl","innerHTML","unmuteControl","fullScreenToggle","enterFullscreen","exitFullscreen","flexibleSpace","create","customFn","elements","_createInline","classList","add","_createStacked","Video","element","videoEl","_findVideoElement","id","Math","random","toString","substring","assign","isPlaying","_isPlaying","isFullscreen","_idleTimeout","_noFullscreen","toggle","_setSourceIds","_createControls","_saveElements","bindEvents","_isMetadataLoaded","_setProgressDisplay","_setBufferDisplay","autoplay","_bindListeners","_onMetadataLoaded","_handleMetadataLoaded","bind","_onClick","_handleClick","_onPlay","_handlePlaying","_onPause","_handlePaused","_onTimeUpdate","_handleTimeUpdate","_onProgress","_handleProgress","_onFullscreenToggle","toggleFullscreen","_onFullscreenChange","_fullscreenChanged","_onVolumeToggle","toggleVolume","_onProgressClick","_handleProgressClick","_onSeeking","_handleSeeking","_onSeeked","_handleSeeked","_onMouseMove","_returnFromIdle","_onIdleTimeout","_wentIdle","_onKeyboardPlaybackToggle","_handleKeyboardPlaybackToggle","_waitForMetadata","getElementByClass","screenfull","enabled","raw","fullscreenchange","fullscreenerror","webkitSupportsFullscreen","currentTimeEl","progressEl","bufferEl","getElementsByTagName","ended","paused","getSourceElements","source","split","Array","from","getElement","getVideoElement","getElementsByClassName","play","pause","togglePlayback","getCurrentTime","setCurrentTime","time","mute","volume","unmute","remove","isMuted","updateSource","getVideoType","extension","sources","filter","videoSource","load","showBuffering","hideBuffering","getPrettyTime","hours","floor","minutes","seconds","ControlsCreator","mainElement","_updateControls","_setCurrentTimeDisplay","textContent","round","percentage","duration","width","buffered","length","end","webkitEnterFullscreen","_toggleFullscreenState","_startIdleTimer","activeElement","blur","focus","_getClickOffset","event","x","offsetX","y","offsetY","rect","currentTarget","getBoundingClientRect","clientX","left","clientY","top","evt","offset","offsetWidth","percent","_getWhichKey","preventDefault","which","charCode","keyCode","listenOnData","cb","loaded","dispose","fullscreenChange","supportTest","autoplayTest","_autoplayTest","all","atob"],"mappings":"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"}