{"version":3,"file":"odo-dialog.js","sources":["../src/scroll-fix.js","../src/dialog.js"],"sourcesContent":["/**\n * @fileoverview Makes an overflowing element scrollable and handles preventing\n * default events and stopping event propagation when the scrollable element is\n * at the top or bottom of the scrollable area.\n *\n * @author Glen Cheney <glen@odopod.com>\n */\n\nimport { randomString } from '@odopod/odo-helpers';\nimport OdoDevice from '@odopod/odo-device';\n\n/**\n * Makes the element scrollable with some smart listeners because iOS\n * behaves unsatisfactory.\n * @param {Element} element Element to use.\n * @param {string} id Unique id.\n * @constructor\n */\nclass ScrollFix {\n  constructor(element, id) {\n    this.element = element;\n    this.id = id;\n    this.startY = null;\n    this.scrollY = null;\n    this._createBoundEvents();\n    this._registerEvents();\n  }\n\n  _createBoundEvents() {\n    this._touchStartBound = this._onTouchStart.bind(this);\n    this._touchMoveBound = this._onTouchMove.bind(this);\n    this._preventDefaultBound = this._preventDefault.bind(this);\n  }\n\n  /**\n   * Add event listeners.\n   * @private\n   */\n  _registerEvents() {\n    document.body.addEventListener('touchstart', this._touchStartBound);\n    document.body.addEventListener('touchmove', this._touchMoveBound);\n    document.addEventListener('touchmove', this._preventDefaultBound);\n  }\n\n  /**\n   * Save positions when the touch starts.\n   * @param {TouchEvent} evt Event object.\n   * @private\n   */\n  _onTouchStart(evt) {\n    this.startY = evt.changedTouches[0].pageY;\n    this.scrollY = this.element.scrollTop;\n  }\n\n  /**\n   * When the touch move and touch start events get to the scrollable element,\n   * prevent them from bubbling further.\n   * @param {TouchEvent} evt Event object.\n   * @private\n   */\n  _onTouchMove(evt) {\n    const deltaY = this.startY - evt.changedTouches[0].pageY;\n    const scrollTop = this.scrollY + deltaY;\n\n    // Prevent default stops all further touches...\n    // the user must lift their finger and swipe again before drags in the\n    // opposite direction register.\n    // However, without this, the same thing occurs, but instead of no\n    // scrolling, the page behind the dialog scrolls.\n    if (scrollTop < 0 || scrollTop + this.element.offsetHeight >\n        this.element.scrollHeight) {\n      evt.preventDefault();\n    } else {\n      evt.stopPropagation();\n    }\n  }\n\n  /**\n   * Simply prevent the event's default action.\n   * @param {TouchEvent} evt Event object.\n   * @private\n   */\n  _preventDefault(evt) {\n    evt.preventDefault();\n  }\n\n  /**\n   * Dispose of this instance by removing handlers and DOM references.\n   */\n  dispose() {\n    document.body.removeEventListener('touchstart', this._touchStartBound);\n    document.body.removeEventListener('touchmove', this._touchMoveBound);\n    document.removeEventListener('touchmove', this._preventDefaultBound);\n\n    this.element = null;\n    this.id = null;\n  }\n}\n\nexport default {\n  /**\n   * Dictionary of ScrollFix instances.\n   * @type {Object.<string, ScrollFix>}\n   * @private\n   */\n  _fixes: new Map(),\n\n  /**\n   * Enable an element to be scrollable.\n   * @param {Element} element Element to make scrollable.\n   * @return {string} Id which is used to remove it.\n   */\n  add(element) {\n    if (OdoDevice.HAS_TOUCH_EVENTS) {\n      const id = randomString();\n      this._fixes.set(id, new ScrollFix(element, id));\n      return id;\n    }\n\n    return '';\n  },\n\n  /**\n   * Disable scrolling on an element and remove event listeners. Be aware\n   * that this removes the scroll fix class. If your element doesn't have\n   * the overflow-scrolling: touch property on it, iOS may flicker the whole\n   * container when calling this method.\n   * @param {string} id Id returned from enable.\n   */\n  remove(id) {\n    if (this._fixes.has(id)) {\n      this._fixes.get(id).dispose();\n      this._fixes.delete(id);\n    }\n  },\n};\n","/**\n * @fileoverview UI Component for universal dialogs.\n * Notes\n * * The transition is on the main `element` so that `scale()` transforms do not\n * cause the calculation of `scrollHeight` to be artificially increased.\n * * The backdrop is a sibling to the dialog so that it does not cover the\n * scrollbar of the dialog and so that it doesn't jitter in iOS.\n *\n * @author Glen Cheney <glen@odopod.com>\n */\n\nimport TinyEmitter from 'tiny-emitter';\nimport { pull, onTransitionEnd } from '@odopod/odo-helpers';\nimport ScrollFix from './scroll-fix';\n\nconst FOCUSABLE_ELEMENTS = [\n  'a[href]',\n  'area[href]',\n  'input:not([disabled])',\n  'select:not([disabled])',\n  'textarea:not([disabled])',\n  'button:not([disabled])',\n  'iframe',\n  'object',\n  'embed',\n  '[contenteditable]',\n  '[tabindex]:not([tabindex^=\"-\"])',\n].join(',');\n\nclass Dialog extends TinyEmitter {\n  /**\n   * Dialog that can contain static images, carousels, or videos\n   * @param {HTMLElement} element Main element.\n   * @param {object} [opts] Instance options.\n   * @constructor\n   */\n  constructor(element, opts) {\n    super();\n\n    if (!(element instanceof HTMLElement)) {\n      throw new TypeError(`OdoDialog requires an element. Got: \"${element}\"`);\n    }\n\n    /**\n     * Base Element.\n     * @type {HTMLElement}\n     */\n    this.element = element;\n\n    /**\n     * Options object.\n     * @type {object}\n     */\n    this.options = Object.assign({}, Dialog.Defaults, opts);\n\n    /**\n     * Dialog Id.\n     * @type {string}\n     */\n    this.id = element.getAttribute('id');\n\n    /**\n     * Dialog backdrop\n     * @type {HTMLElement}\n     * @protected\n     */\n    this.backdrop = document.createElement('div');\n    this.backdrop.className = Dialog.Classes.BACKDROP;\n\n    /**\n     * Dialog content (role=document).\n     * @type {HTMLElement}\n     * @protected\n     */\n    this.content = this.getByClass(Dialog.Classes.CONTENT);\n\n    /**\n     * Elements which, when clicked, close the dialog.\n     * @type {HTMLElement[]}\n     * @private\n     */\n    this._closers = Array.from(this.element.querySelectorAll('[data-odo-dialog-close]'));\n\n    /**\n     * Window resize Id\n     * @type {string}\n     * @private\n     */\n    this._resizeId = null;\n\n    /**\n     * ScrollFix id\n     * @type {?string}\n     * @private\n     */\n    this._scrollFixId = null;\n\n    /**\n     * Whether the dialog is open.\n     * @type {boolean}\n     */\n    this.isOpen = false;\n\n    /**\n     * Is the dialog currently animating.\n     * @type {boolean}\n     * @protected\n     */\n    this.isAnimating = false;\n\n    /**\n     * Whether the body has a scrollbar.\n     * @type {?boolean}\n     * @private\n     */\n    this._hasBodyScrollbar = null;\n\n    /**\n     * Padding on the body.\n     * @type {number}\n     * @private\n     */\n    this._originalBodyPadding = -1;\n\n    /**\n     * Whether this is a fullscreen dialog. Fullscreen dialogs should not have\n     * paddingRight applied to them.\n     * @type {?boolean}\n     * @private\n     */\n    this._isFullscreen = null;\n\n    this.z = Dialog.Z_BASE;\n\n    Dialog.Instances.push(this);\n\n    if (Dialog.Instances.length === 1) {\n      document.body.addEventListener('click', Dialog._handleTriggerClick);\n    }\n\n    // If this browser does not support auto margins for flexbox, add a class\n    // so that it can be centered differently.\n    this.element.classList.toggle(Dialog.Classes.NO_AUTO_MARGIN, !Dialog.SUPPORTS_AUTO_MARGINS);\n\n    this._bindContexts();\n    this.onResize();\n    this._addA11yAttributes();\n    this._ensureBodyChild();\n  }\n\n  /**\n   * Find descendent element by class.\n   * @param {string} name Name of the class to find.\n   * @return {Element|undefined} The element or undefined.\n   */\n  getByClass(name) {\n    return this.element.getElementsByClassName(name)[0];\n  }\n\n  /**\n   * Bind `this` context to event handlers.\n   */\n  _bindContexts() {\n    this.onKeyPress = this.onKeyPress.bind(this);\n    this.onClick = this.onClick.bind(this);\n    this.close = this.close.bind(this);\n    this.closeWithAnimation = this.close.bind(this, false);\n    // Bind undefined as the first parameter so that the event object will be\n    // the second parameter and the optional viewportHeight parameter will work.\n    this.onWindowResize = this.onResize.bind(this, undefined);\n  }\n\n  /**\n   * Add static accessibility attributes so that the implementor can leave them\n   * off or in case they forget.\n   */\n  _addA11yAttributes() {\n    this.element.tabIndex = -1;\n    this.element.setAttribute('aria-hidden', true);\n    this.element.setAttribute('role', 'dialog');\n    this.content.setAttribute('role', 'document');\n  }\n\n  /**\n   * If the dialog element is not a direct descendent of the <body>, make it so.\n   */\n  _ensureBodyChild() {\n    if (this.element.parentNode !== document.body) {\n      document.body.appendChild(this.element);\n    }\n  }\n\n  /**\n   * Determine the correct element to scroll fix and fix it.\n   */\n  _applyScrollFix() {\n    // Allow the scrollable element to be something inside the dialog.\n    if (this.options.scrollableElement) {\n      const element = this.element.matches(this.options.scrollableElement) ?\n        this.element :\n        this.element.querySelector(this.options.scrollableElement);\n      this._scrollFixId = ScrollFix.add(element);\n    }\n  }\n\n  /**\n   * If the page already has a scrollbar, adding overflow: hidden will remove it,\n   * shifting the content to the right. To avoid this, there needs to be padding\n   * on the body that's the same width as the scrollbar, but only when the dialog\n   * will not have a scrollbar to take the page scrollbar's place.\n   * @return {number}\n   */\n  _getScrollbarOffset() {\n    const hasDialogScrollbar = this.element.scrollHeight > document.documentElement.clientHeight;\n    return this._hasBodyScrollbar && !hasDialogScrollbar ? Dialog.SCROLLBAR_WIDTH : 0;\n  }\n\n  /**\n   * Click handler on the main element. When the dialog is dismissable and the\n   * user clicked outside the content (i.e. the backdrop), close it.\n   * @param {MouseEvent} evt Event object.\n   * @protected\n   */\n  onClick(evt) {\n    if (this.options.dismissable && evt.target === this.element) {\n      this.close();\n    }\n  }\n\n  /**\n   * Keypress event handler\n   * @param {KeyboardEvent} evt Event object\n   * @protected\n   */\n  onKeyPress(evt) {\n    // Only react to keys when this dialog is the top-most one.\n    if (this.z === Dialog.getTopLayer()) {\n      // If 'ESC' is pressed, close the dialog\n      if (this.options.dismissable && evt.which === Dialog.Keys.ESC) {\n        this.close();\n      }\n\n      // If the TAB key is being pressed, make sure the focus stays trapped within\n      // the dialog element.\n      if (evt.which === Dialog.Keys.TAB) {\n        Dialog._trapTabKey(this.element, evt);\n      }\n    }\n  }\n\n  /**\n   * The dialog has a height of 100vh, which, in mobile safari, is incorrect\n   * when the toolbars are visible, not allowing the user to scroll the full\n   * height of the content within it.\n   * The viewportHeight parameter is optional so that it can be read in the open()\n   * method with all the other DOM reads. This avoids read->write->read #perfmatters.\n   * @param {number} [viewportHeight=window.innerHeight] Height of the viewport.\n   * @protected\n   */\n  onResize(viewportHeight = window.innerHeight) {\n    this.element.style.height = viewportHeight + 'px';\n  }\n\n  /**\n   * Checks to see if a dialog is already open or animating If not, opens dialog.\n   * @param {boolean} [sync=false] Whether to open with transitions or not.\n   */\n  open(sync = false) {\n    if (this.isAnimating || this.isOpen) {\n      return;\n    }\n\n    const viewportHeight = window.innerHeight;\n    Dialog.focusedBeforeDialog = document.activeElement;\n    this._hasBodyScrollbar = document.body.clientWidth < window.innerWidth;\n    this._isFullscreen = this.element.classList.contains(Dialog.Classes.FULLSCREEN);\n\n    // Add aria-hidden to other top-level things.\n    const siblings = Dialog._getSiblings(this.element);\n    const originals = siblings.map(element => element.getAttribute('aria-hidden'));\n    siblings.forEach((element, i) => {\n      if (originals[i]) {\n        element.setAttribute('data-odo-dialog-original', originals[i]);\n      }\n      element.setAttribute('aria-hidden', true);\n    });\n\n    // If there is already an open dialog, increase the z-index of this dialog's\n    // main element and backdrop above the open one.\n    if (Dialog.getOpenDialogCount() > 0) {\n      this.handleOtherOpenDialogs();\n    }\n\n    this.isOpen = true;\n    this.onResize(viewportHeight);\n    this.element.removeAttribute('aria-hidden');\n    this.element.classList.add(Dialog.Classes.OPEN);\n    this.element.classList.add(Dialog.Classes.ENTER);\n    if (Dialog.SCROLLBAR_WIDTH) {\n      document.body.style.paddingRight = Dialog.SCROLLBAR_WIDTH + 'px';\n    }\n    document.body.classList.add(Dialog.Classes.BODY_OPEN);\n    document.body.insertBefore(this.backdrop, this.element.nextSibling);\n    this.element.scrollTop = 0;\n\n    this._applyScrollFix();\n\n    this.element.focus();\n\n    document.addEventListener('keydown', this.onKeyPress);\n    window.addEventListener('resize', this.onWindowResize);\n    this.element.addEventListener('click', this.onClick);\n    this._closers.forEach((element) => {\n      element.addEventListener('click', this.closeWithAnimation);\n    });\n\n    if (sync === true) {\n      this._openNext();\n      this._opened();\n    } else {\n      Dialog._nextFrame(() => {\n        this._openNext();\n        onTransitionEnd(this.element, this._opened, this, null, 1000);\n      });\n    }\n  }\n\n  /**\n   * Start the transition for opening the dialog.\n   */\n  _openNext() {\n    this.isAnimating = true;\n    // Now that the dialog is no longer display:none, the scrollHeight can be measured.\n    const scrollbarOffset = this._getScrollbarOffset();\n    if (!this._isFullscreen && scrollbarOffset > 0) {\n      this.element.style.paddingRight = scrollbarOffset + 'px';\n    }\n\n    this.element.classList.remove(Dialog.Classes.ENTER);\n    this.element.classList.add(Dialog.Classes.ENTERING);\n  }\n\n  /**\n   * Handle the end of the open transition. Emits OPENED event.\n   */\n  _opened() {\n    this.element.classList.remove(Dialog.Classes.ENTERING);\n    this.element.classList.add(Dialog.Classes.VISIBLE);\n    this.isAnimating = false;\n    this.emit(Dialog.EventType.OPENED);\n  }\n\n  /**\n   * Hides dialog\n   * @param {boolean} [sync=false] Whether to close with transitions or not.\n   */\n  close(sync = false) {\n    if (this.isAnimating || !this.isOpen) {\n      return;\n    }\n\n    // Remove aria-hidden to other top-level things.\n    const siblings = Dialog._getSiblings(this.element);\n    const originals = siblings.map(element => element.getAttribute('data-odo-dialog-original'));\n    siblings.forEach((element, i) => {\n      if (originals[i]) {\n        element.setAttribute('aria-hidden', originals[i]);\n        element.removeAttribute('data-odo-dialog-original');\n      } else {\n        element.removeAttribute('aria-hidden');\n      }\n    });\n\n    this.isOpen = false;\n    this.element.classList.add(Dialog.Classes.LEAVE);\n    this.element.classList.remove(Dialog.Classes.VISIBLE);\n\n    ScrollFix.remove(this._scrollFixId);\n\n    // Support: IE11\n    // Clicking on an SVG element inside an <a> will set the `focusedBeforeDialog`\n    // to the SVG, but SVG doesn't have a `focus()` method in IE.\n    if (Dialog.focusedBeforeDialog && typeof Dialog.focusedBeforeDialog.focus === 'function') {\n      Dialog.focusedBeforeDialog.focus();\n    }\n\n    document.removeEventListener('keydown', this.onKeyPress);\n    window.removeEventListener('resize', this.onWindowResize);\n    this.element.removeEventListener('click', this.onClick);\n    this._closers.forEach((element) => {\n      element.removeEventListener('click', this.closeWithAnimation);\n    });\n\n    if (sync === true) {\n      this._closeNext();\n      this._closed();\n    } else {\n      Dialog._nextFrame(() => {\n        this._closeNext();\n        onTransitionEnd(this.element, this._closed, this, null, 1000);\n      });\n    }\n  }\n\n  /**\n   * Start the transition for closing the dialog.\n   */\n  _closeNext() {\n    this.isAnimating = true;\n    this.element.classList.remove(Dialog.Classes.LEAVE);\n    this.element.classList.add(Dialog.Classes.LEAVING);\n  }\n\n  /**\n   * Handle the end of the close transition. Emits the CLOSED event.\n   */\n  _closed() {\n    this.isAnimating = false;\n    this.element.style.paddingRight = '';\n    this.element.setAttribute('aria-hidden', true);\n    this.element.classList.remove(Dialog.Classes.OPEN);\n    this.element.classList.remove(Dialog.Classes.LEAVING);\n    if (Dialog.getOpenDialogCount() === 0) {\n      document.body.style.paddingRight = '';\n      document.body.classList.remove(Dialog.Classes.BODY_OPEN);\n    }\n    document.body.removeChild(this.backdrop);\n    this.emit(Dialog.EventType.CLOSED);\n  }\n\n  /**\n   * Modify dialog z-indices and more because there are about to be multiple\n   * dialogs open at the same time.\n   * @protected\n   */\n  handleOtherOpenDialogs() {\n    this.z = Dialog.getTopLayer() + 20;\n    this.element.style.zIndex = this.z;\n    this.backdrop.style.zIndex = this.z - 5;\n\n    // When this dialog is closed, revert the z-index back to its original value.\n    this.once(Dialog.EventType.CLOSED, () => {\n      this.z = Dialog.Z_BASE;\n      this.element.style.zIndex = '';\n      this.backdrop.style.zIndex = '';\n\n      // Find new top dialog.\n      const zTop = Dialog.getTopLayer();\n\n      Dialog.Instances.forEach((instance) => {\n        if (instance.isOpen && instance.z === zTop) {\n          instance.didEnterForeground();\n        }\n      });\n    });\n\n    // Tell other dialogs they're going into the background.\n    Dialog.Instances.forEach((instance) => {\n      if (instance.isOpen && instance.id !== this.id) {\n        instance.didEnterBackground();\n      }\n    });\n  }\n\n  /**\n   * Dialog went into the background and has another dialog open above it.\n   * @protected\n   */\n  didEnterBackground() {\n    ScrollFix.remove(this._scrollFixId);\n  }\n\n  /**\n   * Dialog came back into the foreground after being in the background.\n   * @protected\n   */\n  didEnterForeground() {\n    this._applyScrollFix();\n  }\n\n  /**\n   * Close the dialog, remove event listeners and element references.\n   */\n  dispose() {\n    if (this.isOpen) {\n      this.close(true);\n    }\n\n    this.element = null;\n    this.content = null;\n    this.backdrop = null;\n    this._closers.length = 0;\n\n    pull(Dialog.Instances, this);\n\n    // If this is the last dialog (being disposed), remove the body listener.\n    if (Dialog.Instances.length === 0) {\n      document.body.removeEventListener('click', Dialog._handleTriggerClick);\n    }\n  }\n\n  /**\n   * Call a function after two animation frames. Using just one is unreliable\n   * when using animations to/from display:none elements or ones that are not\n   * yet in the DOM.\n   * @param {function} fn Function to call on the next frame.\n   */\n  static _nextFrame(fn) {\n    window.requestAnimationFrame(window.requestAnimationFrame.bind(null, fn));\n  }\n\n  /**\n   * Open the correct dialog when an element with `data-odo-dialog-open` attribute\n   * is clicked.\n   * @param {Event} evt Event object.\n   */\n  static _handleTriggerClick(evt) {\n    const trigger = evt.target.closest('[data-odo-dialog-open]');\n\n    if (trigger !== null) {\n      evt.preventDefault();\n      const id = trigger.getAttribute('data-odo-dialog-open');\n      const instance = Dialog.getDialogById(id);\n      instance.emit(Dialog.EventType.TRIGGER_CLICKED, trigger);\n      instance.open();\n    }\n  }\n\n  /**\n   * Trap the focus inside the given element.\n   * @param {Element} node\n   * @param {KeyboardEvent} evt\n   */\n  static _trapTabKey(node, evt) {\n    const focusableChildren = Dialog._getFocusableChildren(node);\n    const focusedItemIndex = focusableChildren.indexOf(document.activeElement);\n\n    // If the SHIFT key is being pressed while tabbing (moving backwards) and\n    // the currently focused item is the first one, move the focus to the last\n    // focusable item from the dialog element\n    if (evt.shiftKey && focusedItemIndex === 0) {\n      focusableChildren[focusableChildren.length - 1].focus();\n      evt.preventDefault();\n    // If the SHIFT key is not being pressed (moving forwards) and the currently\n    // focused item is the last one, move the focus to the first focusable item\n    // from the dialog element\n    } else if (!evt.shiftKey && focusedItemIndex === focusableChildren.length - 1) {\n      focusableChildren[0].focus();\n      evt.preventDefault();\n    }\n  }\n\n  /**\n   * Get the focusable children of the given element.\n   * @param {Element} element\n   * @return {Element[]}\n   */\n  static _getFocusableChildren(element) {\n    return Array.from(element.querySelectorAll(FOCUSABLE_ELEMENTS))\n      .filter(Dialog._isVisibleElement);\n  }\n\n  /**\n   * Whether an element is visible (and therefore can receive focus). Uses\n   * `getClientRects` due to this issue:\n   * https://github.com/jquery/jquery/issues/2227\n   * http://jsfiddle.net/2tgw2yr3/\n   * @param {HTMLElement} el Element.\n   * @return {boolean}\n   */\n  static _isVisibleElement(el) {\n    return !!(el.offsetWidth || el.offsetHeight || el.getClientRects().length);\n  }\n\n  /**\n   * Retrieve the siblings of an element.\n   * @param {Element} element Element to get siblings for.\n   * @return {Array.<Element>}\n   */\n  static _getSiblings(element) {\n    const children = Array.from(element.parentElement.children);\n    const ignore = ['script', 'link', 'meta'];\n    return children.filter(node =>\n      node !== element && !ignore.includes(node.nodeName.toLowerCase()));\n  }\n\n  /**\n   * Calculate the width of the scrollbar because when the body has overflow:hidden,\n   * the scrollbar disappears.\n   * https://davidwalsh.name/detect-scrollbar-width\n   * @return {number}\n   */\n  static _getScrollbarWidth() {\n    // Create measurement node.\n    const scrollDiv = document.createElement('div');\n    scrollDiv.style.cssText = 'width:50px;height:50px;overflow:scroll;position:absolute;top:-9999px;';\n    document.body.appendChild(scrollDiv);\n\n    // Calculate the scrollbar width.\n    const scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;\n\n    // Remove test element.\n    document.body.removeChild(scrollDiv);\n\n    return scrollbarWidth;\n  }\n\n  /**\n   * Unfortunately, the auto margins do not work for flex children in IE11 and\n   * below because the content element does have an explicit height set on it.\n   * @return {boolean}\n   */\n  static _autoMarginTest() {\n    const parent = document.createElement('div');\n    const child = document.createElement('div');\n    parent.style.cssText = 'display:flex;height:50px;width:50px;position:absolute;';\n    child.style.cssText = 'margin:auto;';\n    child.innerHTML = 'a';\n    parent.appendChild(child);\n    document.body.appendChild(parent);\n\n    const ret = child.offsetTop > 0;\n    document.body.removeChild(parent);\n\n    return ret;\n  }\n\n  /**\n   * Instantiates all instances of dialogs with the same settings\n   * @param {object} options Object of all dialog options. Is optional.\n   * @return {Dialog[]}\n   */\n  static initializeAll(options) {\n    Dialog.disposeAll();\n\n    return Array.from(\n      document.querySelectorAll('.' + Dialog.Classes.BASE),\n      dialog => new Dialog(dialog, options),\n    );\n  }\n\n  /**\n   * Clear all references to dialogs so there are no duplicates.\n   */\n  static disposeAll() {\n    const clone = Dialog.Instances.slice();\n    clone.forEach((dialog) => {\n      dialog.dispose();\n    });\n  }\n\n  /**\n   * Retrieve a dialog instance by its id.\n   * @param {string} id Id of the dialog.\n   * @return {?Dialog} The dialog or undefined if there is no dialog with the given id.\n   */\n  static getDialogById(id) {\n    return Dialog.Instances.find(instance => instance.id === id);\n  }\n\n  /**\n   * Count how many dialogs are currently open.\n   * @return {number}\n   */\n  static getOpenDialogCount() {\n    return Dialog.Instances.filter(instance => instance.isOpen).length;\n  }\n\n  /**\n   * Find the z index of the top-most dialog instance.\n   * @return {number}\n   */\n  static getTopLayer() {\n    // eslint-disable-next-line prefer-spread\n    return Math.max.apply(Math, Dialog.Instances.map(instance => instance.z));\n  }\n}\n\n/** @enum {string} */\nDialog.Classes = {\n  BODY_OPEN: 'odo-dialog-open',\n  BASE: 'odo-dialog',\n  OPEN: 'odo-dialog--open',\n  ENTER: 'odo-dialog--enter',\n  ENTERING: 'odo-dialog--enter-active',\n  LEAVE: 'odo-dialog--leave',\n  LEAVING: 'odo-dialog--leave-active',\n  VISIBLE: 'odo-dialog--visible',\n  FULLSCREEN: 'odo-dialog--full',\n  NO_AUTO_MARGIN: 'odo-dialog--no-auto-margin',\n  BACKDROP: 'odo-dialog-backdrop',\n  CONTENT: 'odo-dialog__content',\n};\n\n/** @enum {string} */\nDialog.EventType = {\n  OPENED: 'ododialog:open',\n  CLOSED: 'ododialog:closed',\n  TRIGGER_CLICKED: 'ododialog:triggerclicked',\n};\n\n/** @enum {number} */\nDialog.Keys = {\n  ESC: 27,\n  TAB: 9,\n};\n\nDialog.Defaults = {\n  dismissable: true,\n  scrollableElement: '.odo-dialog',\n};\n\n/** @type {Dialog[]} */\nDialog.Instances = [];\n\nDialog.Z_BASE = 1050;\n\nDialog.ScrollFix = ScrollFix;\n\n/**\n * Element which had focus before the dialog opened.\n * @type {Element}\n */\nDialog.focusedBeforeDialog = null;\n\nDialog.SUPPORTS_AUTO_MARGINS = Dialog._autoMarginTest();\nDialog.SCROLLBAR_WIDTH = Dialog._getScrollbarWidth();\n\nexport default Dialog;\n"],"names":["ScrollFix","element","id","startY","scrollY","_createBoundEvents","_registerEvents","_touchStartBound","_onTouchStart","bind","_touchMoveBound","_onTouchMove","_preventDefaultBound","_preventDefault","document","body","addEventListener","evt","changedTouches","pageY","scrollTop","deltaY","offsetHeight","scrollHeight","preventDefault","stopPropagation","dispose","removeEventListener","_fixes","Map","add","OdoDevice","HAS_TOUCH_EVENTS","randomString","set","remove","has","get","delete","FOCUSABLE_ELEMENTS","join","Dialog","opts","HTMLElement","TypeError","options","Object","assign","Defaults","getAttribute","backdrop","createElement","className","Classes","BACKDROP","content","getByClass","CONTENT","_closers","Array","from","querySelectorAll","_resizeId","_scrollFixId","isOpen","isAnimating","_hasBodyScrollbar","_originalBodyPadding","_isFullscreen","z","Z_BASE","Instances","push","length","_handleTriggerClick","classList","toggle","NO_AUTO_MARGIN","SUPPORTS_AUTO_MARGINS","_bindContexts","onResize","_addA11yAttributes","_ensureBodyChild","name","getElementsByClassName","onKeyPress","onClick","close","closeWithAnimation","onWindowResize","undefined","tabIndex","setAttribute","parentNode","appendChild","_applyScrollFix","scrollableElement","matches","querySelector","_getScrollbarOffset","hasDialogScrollbar","documentElement","clientHeight","SCROLLBAR_WIDTH","dismissable","target","getTopLayer","which","Keys","ESC","TAB","_trapTabKey","viewportHeight","window","innerHeight","style","height","open","sync","focusedBeforeDialog","activeElement","clientWidth","innerWidth","contains","FULLSCREEN","siblings","_getSiblings","originals","map","forEach","i","getOpenDialogCount","handleOtherOpenDialogs","removeAttribute","OPEN","ENTER","paddingRight","BODY_OPEN","insertBefore","nextSibling","focus","_openNext","_opened","_nextFrame","onTransitionEnd","scrollbarOffset","ENTERING","VISIBLE","emit","EventType","OPENED","LEAVE","_closeNext","_closed","LEAVING","removeChild","CLOSED","zIndex","once","zTop","instance","didEnterForeground","didEnterBackground","pull","fn","requestAnimationFrame","trigger","closest","getDialogById","TRIGGER_CLICKED","node","focusableChildren","_getFocusableChildren","focusedItemIndex","indexOf","shiftKey","filter","_isVisibleElement","el","offsetWidth","getClientRects","children","parentElement","ignore","includes","nodeName","toLowerCase","_getScrollbarWidth","scrollDiv","cssText","scrollbarWidth","_autoMarginTest","parent","child","innerHTML","ret","offsetTop","initializeAll","disposeAll","BASE","dialog","clone","slice","find","Math","max","apply","TinyEmitter"],"mappings":"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"}