{"version":3,"file":"odo-object-fit.min.js","sources":["../src/object-fit.js"],"sourcesContent":["/**\n * @fileoverview A helper which fits media elements (img, video). It polyfills\n * CSS' object-fit: cover and contain. If the browser supports object-fit, it\n * will not run. The media element should have full width and height as well as\n * the object-fit property.\n *\n * Usage:\n *\n *     .my-element {\n *       width: 100%;\n *       height: 100%;\n *       object-fit: cover;\n *     }\n *\n *     // Cover a single element.\n *     ObjectFit.cover(myElement);\n *\n *     // Cover multiple media elements.\n *     ObjectFit.cover([myElement, thatOtherElement]);\n */\n\nclass ObjectFit {\n  constructor(element, style) {\n    /** @type {HTMLImageElement|HTMLVideoElement} */\n    this.element = element;\n\n    /** @type {ObjectFit.Style} */\n    this.style = style;\n\n    /** @private {boolean} */\n    this._isVideo = element.nodeName.toLowerCase() === 'video';\n\n    /** @private {number} */\n    this._mediaRatio = null;\n\n    this._listenForMediaLoad();\n  }\n\n  /**\n   * Calculate the dimenions of the media element and set them.\n   * @param {HTMLElement} el Element to size.\n   * @private\n   */\n  _fit(el) {\n    const container = this._getParentSize();\n    const element = this._getFitSize(container.width, container.height);\n\n    el.style.width = element.width + 'px';\n    el.style.height = element.height + 'px';\n    el.style.marginLeft = ((container.width - element.width) / 2) + 'px';\n    el.style.marginTop = ((container.height - element.height) / 2) + 'px';\n  }\n\n  /**\n   * Retrieve the width and height of the containing block.\n   * @return {{width: number, height: number}}\n   * @private\n   */\n  _getParentSize() {\n    return {\n      width: this.element.parentElement.offsetWidth,\n      height: this.element.parentElement.offsetHeight,\n    };\n  }\n\n  /**\n   * Calculate the width and height of the media element based on the containing\n   * block's width/height and the object-fit style.\n   * @param {number} containerWidth Containing block's width.\n   * @param {number} containerHeight Containing block's height.\n   * @return {{width: number, height: number}}\n   * @private\n   */\n  _getFitSize(containerWidth, containerHeight) {\n    const containerRatio = containerWidth / containerHeight;\n    let elementWidth;\n    let elementHeight;\n\n    if (this.style === ObjectFit.Style.COVER) {\n      // Determine the actual width and height of the image when it's covering the area.\n      if (this._mediaRatio > containerRatio) {\n        elementWidth = containerHeight * this._mediaRatio;\n        elementHeight = containerHeight;\n      } else {\n        elementWidth = containerWidth;\n        elementHeight = containerWidth / this._mediaRatio;\n      }\n    } else /* if this.style === ObjectFit.Style.CONTAIN */ if (this._mediaRatio > containerRatio) {\n      elementWidth = containerWidth;\n      elementHeight = containerWidth / this._mediaRatio;\n    } else {\n      elementWidth = containerHeight * this._mediaRatio;\n      elementHeight = containerHeight;\n    }\n\n    return {\n      width: Math.round(elementWidth),\n      height: Math.round(elementHeight),\n    };\n  }\n\n  /**\n   * Retrieves the media element's width/height ratio.\n   * @return {number}\n   * @private\n   */\n  _getMediaRatio() {\n    if (this._isVideo) {\n      return this.element.videoWidth / this.element.videoHeight;\n    }\n    return this.element.naturalWidth / this.element.naturalHeight;\n  }\n\n  /**\n   * Listen for when the metadata (video width/height) is loaded for videos or\n   * the load event for images.\n   * @return {string}\n   */\n  get _loadEventName() {\n    return this._isVideo ? 'loadedmetadata' : 'load';\n  }\n\n  /** @private */\n  _listenForMediaLoad() {\n    this._mediaLoadedHandler = this._handleMediaLoaded.bind(this);\n\n    if (this._isMediaLoaded(this.element)) {\n      this._mediaLoadedHandler();\n    } else {\n      this.element.addEventListener(this._loadEventName, this._mediaLoadedHandler);\n    }\n  }\n\n  /**\n   * Videos have a readyState. Anything greater than zero means it has metadata.\n   * Some browsers implement the `complete` property on images. Also test the `naturalWidth`.\n   * @param {HTMLImageElement|HTMLVideoElement} element Media element.\n   * @return {boolean}\n   */\n  _isMediaLoaded(element) {\n    return element.readyState > 0 || (element.src && element.complete) || element.naturalWidth > 0;\n  }\n\n  /** @private */\n  _unlistenForMediaLoad() {\n    this.element.removeEventListener(this._loadEventName, this._mediaLoadedHandler);\n  }\n\n  /**\n   * Image loaded, it has `naturalWidth` and `naturalHeight` properties.\n   *\n   * Video metadata loaded, all attributes now contain as much useful information\n   * as they're going to.\n   * @private\n   */\n  _handleMediaLoaded() {\n    this._unlistenForMediaLoad();\n    this._mediaRatio = this._getMediaRatio();\n    this._fit(this.element);\n    this.element = null;\n  }\n\n  /**\n   * Create new object fit objects to cover their container.\n   * @param {ArrayLike.<Element>|Element} elements An array-like of elements or\n   *     a single element.\n   * @static\n   */\n  static cover(elements) {\n    ObjectFit._run(elements, ObjectFit.Style.COVER);\n  }\n\n  /**\n   * Create new object fit objects to be contained in their container.\n   * @param {ArrayLike.<Element>|Element} elements An array-like of elements or\n   *     a single element.\n   * @static\n   */\n  static contain(elements) {\n    ObjectFit._run(elements, ObjectFit.Style.CONTAIN);\n  }\n\n  /**\n   * Gives the ability to pass multiple elements. Fails silently when no elements\n   * are given or exits early if the browser supports object-fit.\n   * @param {ArrayLike.<Element>|Element} elements An array-like of elements or\n   *     a single element.\n   * @param {ObjectFit.Style} type What type of object-fit this is.\n   * @static\n   */\n  static _run(elements, type) {\n    // Exit early if it already supports object-fit.\n    if (ObjectFit.SUPPORTED || !elements || (elements && elements.length === 0)) {\n      return;\n    }\n\n    if (elements.length) {\n      for (let i = 0; i < elements.length; i++) {\n        new ObjectFit(elements[i], type); // eslint-disable-line no-new\n      }\n    } else {\n      new ObjectFit(elements, type); // eslint-disable-line no-new\n    }\n  }\n}\n\n/**\n * Whether the browser supports object-fit.\n * @type {boolean}\n */\nObjectFit.SUPPORTED = document.createElement('div').style.objectFit === '';\n\n/** @enum {number} */\nObjectFit.Style = {\n  COVER: 1,\n  CONTAIN: 2,\n};\n\nexport default ObjectFit;\n"],"names":["ObjectFit","element","style","_isVideo","nodeName","toLowerCase","_mediaRatio","_listenForMediaLoad","_fit","el","container","this","_getParentSize","_getFitSize","width","height","marginLeft","marginTop","parentElement","offsetWidth","offsetHeight","containerWidth","containerHeight","containerRatio","elementWidth","elementHeight","Style","COVER","Math","round","_getMediaRatio","videoWidth","videoHeight","naturalWidth","naturalHeight","_mediaLoadedHandler","_handleMediaLoaded","bind","_isMediaLoaded","addEventListener","_loadEventName","readyState","src","complete","_unlistenForMediaLoad","removeEventListener","cover","elements","_run","contain","CONTAIN","type","SUPPORTED","length","i","document","createElement","objectFit"],"mappings":"ghBAqBMA,wBACQC,EAASC,kBAEdD,QAAUA,OAGVC,MAAQA,OAGRC,SAA8C,UAAnCF,EAAQG,SAASC,mBAG5BC,YAAc,UAEdC,yCAQPC,cAAKC,OACGC,EAAYC,KAAKC,iBACjBX,EAAUU,KAAKE,YAAYH,EAAUI,MAAOJ,EAAUK,UAEzDb,MAAMY,MAAQb,EAAQa,MAAQ,OAC9BZ,MAAMa,OAASd,EAAQc,OAAS,OAChCb,MAAMc,YAAeN,EAAUI,MAAQb,EAAQa,OAAS,EAAK,OAC7DZ,MAAMe,WAAcP,EAAUK,OAASd,EAAQc,QAAU,EAAK,kBAQnEH,uCAEWD,KAAKV,QAAQiB,cAAcC,mBAC1BR,KAAKV,QAAQiB,cAAcE,2BAYvCP,qBAAYQ,EAAgBC,OACpBC,EAAiBF,EAAiBC,EACpCE,SACAC,gBAEAd,KAAKT,QAAUF,EAAU0B,MAAMC,MAE7BhB,KAAKL,YAAciB,KACND,EAAkBX,KAAKL,cACtBgB,MAEDD,IACCA,EAAiBV,KAAKL,aAEiBK,KAAKL,YAAciB,KAC7DF,IACCA,EAAiBV,KAAKL,gBAEvBgB,EAAkBX,KAAKL,cACtBgB,UAITM,KAAKC,MAAML,UACVI,KAAKC,MAAMJ,iBASvBK,iCACMnB,KAAKR,SACAQ,KAAKV,QAAQ8B,WAAapB,KAAKV,QAAQ+B,YAEzCrB,KAAKV,QAAQgC,aAAetB,KAAKV,QAAQiC,2BAalD3B,oCACO4B,oBAAsBxB,KAAKyB,mBAAmBC,KAAK1B,MAEpDA,KAAK2B,eAAe3B,KAAKV,cACtBkC,2BAEAlC,QAAQsC,iBAAiB5B,KAAK6B,eAAgB7B,KAAKwB,kCAU5DG,wBAAerC,UACNA,EAAQwC,WAAa,GAAMxC,EAAQyC,KAAOzC,EAAQ0C,UAAa1C,EAAQgC,aAAe,eAI/FW,sCACO3C,QAAQ4C,oBAAoBlC,KAAK6B,eAAgB7B,KAAKwB,kCAU7DC,mCACOQ,6BACAtC,YAAcK,KAAKmB,sBACnBtB,KAAKG,KAAKV,cACVA,QAAU,QASV6C,eAAMC,KACDC,KAAKD,EAAU/C,EAAU0B,MAAMC,UASpCsB,iBAAQF,KACHC,KAAKD,EAAU/C,EAAU0B,MAAMwB,YAWpCF,cAAKD,EAAUI,QAEhBnD,EAAUoD,YAAcL,GAAaA,GAAgC,IAApBA,EAASM,WAI1DN,EAASM,WACN,IAAIC,EAAI,EAAGA,EAAIP,EAASM,OAAQC,QAC/BtD,EAAU+C,EAASO,GAAIH,YAGzBnD,EAAU+C,EAAUI,qDAlFnBxC,KAAKR,SAAW,iBAAmB,uBA2F9CH,EAAUoD,UAA8D,KAAlDG,SAASC,cAAc,OAAOtD,MAAMuD,UAG1DzD,EAAU0B,aACD,UACE"}