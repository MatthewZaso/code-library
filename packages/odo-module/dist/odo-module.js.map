{"version":3,"file":"odo-module.js","sources":["../src/module-utils.js","../src/module-methods.js","../src/module.js"],"sourcesContent":["/**\n * Utilities for the Odo Module component.\n *\n * @author Nathan Buchar <nathan@odopod.com>\n */\n\n/**\n * If the first parameter is not an array, return an array containing the\n * first parameter.\n *\n * @author Glen Cheney <glen@odopod.com>\n * @param {*} thing - Anything.\n * @returns {Array.<*>} Array of things.\n */\nexport function arrayify(thing) {\n  if (Array.isArray(thing)) {\n    return thing;\n  }\n\n  if (thing && typeof thing.length === 'number') {\n    return Array.from(thing);\n  }\n\n  return [thing];\n}\n\n/**\n * Determine if the given item is an HTMLElement. Adapted from\n * {@link http://stackoverflow.com/a/36894871/373422}\n *\n * @param {*} thing - Anything.\n * @returns {boolean}\n */\nexport function isHTMLElement(thing) {\n  return thing instanceof Element;\n}\n","/**\n * Any method defined here will be automatically applied to all OdoModules.\n *\n * @author Nathan Buchar <nathan@odopod.com>\n */\n\nimport { arrayify, isHTMLElement } from './module-utils';\n\nexport default (Module, selector) => ({\n  /**\n   * Gets the Module instance for a given element, if it has been created.\n   * Returns undefined if no instance was found for this element.\n   *\n   * @param {HTMLElement} element\n   * @returns {?Module}\n   */\n  getInstance(element) {\n    return Module.Instances.get(element);\n  },\n\n  /**\n   * Removes a given module instance from the Instances Map and calls the\n   * \"dispose\" method on the instance, if it is implemented. Returns true if\n   * the module instance was removed, or false if no module instance\n   * exists for the given element\n   *\n   * @param {HTMLElement} element\n   * @returns {boolean}\n   */\n  deleteInstance(element) {\n    const instance = Module.getInstance(element);\n\n    if (instance) {\n      Module.Instances.delete(element);\n\n      // Call the \"dispose\" method if it is implemented by the module.\n      if (typeof instance.dispose === 'function') {\n        instance.dispose();\n      }\n\n      return true;\n    }\n\n    return false;\n  },\n\n  /**\n   * Initalize Components from an element, or an array or NodeList of\n   * elements. Returns a Map of all instances created, keyed by their\n   * respective base elements.\n   *\n   * @param {arrayLike<HTLMElement>|HTMLElement} elements\n   * @param {Object} [options={}]\n   * @returns {Map} instances\n   */\n  initialize(elements, options = {}) {\n    if (typeof elements === 'undefined') {\n      throw new TypeError('Element(s) to initialize must be defined.');\n    }\n\n    const instances = new Map();\n\n    arrayify(elements).forEach((element) => {\n      // Verify that the element is in fact an HTML Element.\n      if (!isHTMLElement(element)) {\n        throw new TypeError(`Expected HTML Element. Got \"${Object.prototype.toString.call(element)}\".`);\n      }\n\n      // Verify that an instance has not already been initialized for this element.\n      if (Module.Instances.has(element)) {\n        // eslint-disable-next-line no-console\n        console.warn('An instance has already been initialized for this element.');\n        return;\n      }\n\n      const instance = new Module(element, options);\n\n      instances.set(element, instance);\n      Module.Instances.set(element, instance);\n    });\n\n    return instances;\n  },\n\n  /**\n   * Initializes all Module within the given context.\n   * @param {Object} [context=document]\n   * @param {Object} [options={}]\n   * @returns {Map}\n   */\n  initializeAll(context = document, options = {}) {\n    return Module.initialize(context.querySelectorAll(selector), options);\n  },\n\n  /**\n   * Initializes all Module within the given context.\n   * @param {Object} [context=document]\n   */\n  disposeAll(context = document) {\n    arrayify(context.querySelectorAll(selector)).forEach((element) => {\n      Module.deleteInstance(element);\n    });\n  },\n});\n","/**\n * Entry point into the Odo Module component. Exposes a single `register`\n * static property, which when called will register the given base selector\n * with the given module class and apply several static methods and properties.\n *\n * @author Nathan Buchar <nathan@odopod.com>\n */\n\nimport OdoModuleMethods from './module-methods';\n\n/**\n * A map of all registered modules, keyed by the base selector. No two\n * registers may share the same base selector.\n * @type {Map}\n * @private\n */\nconst store = new Map();\n\n/**\n * Determine the base selector for this module.\n * @param {Object} Module\n * @param {string} [selector]\n * @return {string} Updated selector string.\n * @throws {TypeError} If the selector cannot be determined.\n */\nfunction getSelector(Module, selector) {\n  // Verify that a base selector is defined.\n  if (typeof selector === 'undefined') {\n    if (Module.Selectors && Module.Selectors.BASE) {\n      return Module.Selectors.BASE;\n    }\n\n    // Support both `ClassName` and `Classes` enumerations.\n    const classes = Module.ClassName || Module.Classes;\n    if (classes && classes.BASE) {\n      return '.' + classes.BASE;\n    }\n\n    throw new TypeError('A base selector for this module must be specified.');\n  }\n\n  return selector;\n}\n\n/**\n * Ensure all required properties exist.\n * @param {Object} Module\n * @param {string} [selector]\n * @throws {TypeError} When something is missing.\n * @private\n */\nfunction validate(Module, selector) {\n  // Verify that the Module is an Object or Class.\n  const type = Object.prototype.toString.call(Module);\n  const isObject = type === '[object Object]';\n  const isFunction = type === '[object Function]';\n  if (!(isObject || isFunction)) {\n    throw new TypeError(`Module must be an Function (class) or Object. Got \"${Object.prototype.toString.call(Module)}\".`);\n  }\n\n  // Verify that the module has not yet been registered.\n  if (store.has(selector)) {\n    throw new TypeError('The base selector for this module has already been registered. Please use a unique base selector.');\n  }\n}\n\n/**\n * Adds static methods and internally registers the module.\n * @param {Object} Module\n * @param {string} [selector]\n * @return {Object} The module.\n */\nfunction register(Module, selector) {\n  const _selector = getSelector(Module, selector);\n\n  validate(Module, _selector);\n\n  const methods = OdoModuleMethods(Module, _selector);\n\n  // Apply OdoModule static methods.\n  Object.keys(methods).forEach((method) => {\n    Module[method] = methods[method];\n  });\n\n  // Apply the OdoModule static property.\n  Module.Instances = new Map();\n\n  // Internally register the module.\n  store.set(_selector, Module);\n\n  return Module;\n}\n\n/**\n * Forget about this module. Currently leaves methods and instances as-is in\n * case they're needed.\n * @param {Object} Module\n * @param {string} [selector]\n */\nfunction unregister(Module, selector) {\n  const _selector = getSelector(Module, selector);\n\n  // Internally unregister the module.\n  store.delete(_selector, Module);\n}\n\nexport default { register, unregister };\n"],"names":["arrayify","thing","Array","isArray","length","from","isHTMLElement","Element","Module","selector","element","Instances","get","instance","getInstance","delete","dispose","elements","options","TypeError","instances","Map","forEach","Object","prototype","toString","call","has","warn","set","context","document","initialize","querySelectorAll","deleteInstance","store","getSelector","Selectors","BASE","classes","ClassName","Classes","validate","type","isObject","isFunction","register","_selector","methods","OdoModuleMethods","keys","method","unregister"],"mappings":"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"}