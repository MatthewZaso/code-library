{"version":3,"file":"odo-tabs.js","sources":["../src/tabs-event.js","../src/tabs.js"],"sourcesContent":["class TabsEvent {\n  /**\n   * Object representing a tab event.\n   * @param {string} type Event type.\n   * @param {number} index Index of tab.\n   * @constructor\n   */\n  constructor(type, index) {\n    this.type = type;\n\n    /** @type {number} */\n    this.index = index;\n\n    /** @type {boolean} Whether `preventDefault` has been called. */\n    this.defaultPrevented = false;\n  }\n\n  preventDefault() {\n    this.defaultPrevented = true;\n  }\n}\n\nexport default TabsEvent;\n","/**\n * @fileoverview Easy tabs. Inspired by bootstrap and jQuery UI.\n *\n * {@link http://jqueryui.com/tabs/}\n * {@link https://github.com/jquery/jquery-ui/blob/master/ui/tabs.js}\n * {@link http://www.marcozehe.de/2013/02/02/advanced-aria-tip-1-tabs-in-web-apps/}\n * {@link http://git.aaronlumsden.com/tabulous.js/}\n *\n * @author Glen Cheney <glen@odopod.com>\n */\n\nimport TinyEmitter from 'tiny-emitter';\nimport { giveId, clamp, setHash } from '@odopod/odo-helpers';\nimport OdoWindowEvents from '@odopod/odo-window-events';\nimport TabsEvent from './tabs-event';\n\nlet id = 0;\nfunction uniqueId() {\n  id += 1;\n  return `odo-tabs${id}`;\n}\n\nclass Tabs extends TinyEmitter {\n  /**\n   * A tabs component.\n   * @param {Element} element The tabs list element.\n   * @constructor\n   */\n  constructor(element) {\n    super();\n\n    /** @type {Element} */\n    this.element = element;\n\n    /** @private {number} */\n    this._selectedIndex = -1;\n\n    /**\n     * List items, children of the tabs list.\n     * @type {Array.<Element>}\n     */\n    this.tabs = Array.from(this.element.children);\n\n    /**\n     * Anchor elements inside the tab.\n     * @type {Array.<HTMLAnchorElement>}\n     */\n    this.anchors = this.tabs.map(tab => tab.querySelector('a'));\n\n    /**\n     * Tab pane elements.\n     * @type {Array.<HTMLElement>}\n     */\n    this.panes = this.anchors.map(anchor => document.getElementById(anchor.getAttribute('href').substring(1)));\n\n    /**\n     * Wrapper for the panes.\n     * @type {HTMLElement}\n     */\n    this.panesContainer = this.panes[0].parentElement;\n\n    /**\n     * Get an array of [possible] hashes.\n     * @type {Array.<?string>}\n     */\n    this.hashes = this.anchors.map(anchor => anchor.getAttribute('data-hash'));\n\n    this.init();\n  }\n\n  init() {\n    const startIndex = this.getStartingIndex();\n\n    // Bind events.\n    this._setupHandlers();\n\n    // Add aria roles.\n    this._processTabs();\n\n    // Show the first or the one in the #hash.\n    this.setSelectedIndex(startIndex, true);\n  }\n\n  /**\n   * Determine the starting tab index. It will first look at the URL's #hash, then\n   * for a pane which has the IS_SELECTED class, defaulting to the first tab if\n   * neither of those exist.\n   * @return {number}\n   */\n  getStartingIndex() {\n    const hashIndex = this._getWindowHashIndex();\n\n    if (hashIndex > -1) {\n      return hashIndex;\n    }\n\n    const startIndex = this.panes.findIndex(pane => pane.matches('.' + Tabs.ClassName.IS_SELECTED));\n\n    if (startIndex > -1) {\n      return startIndex;\n    }\n\n    return 0;\n  }\n\n  /**\n   * Set tabIndex attribute, add any aria roles and classes.\n   * @protected\n   */\n  _processTabs() {\n    this.element.classList.add(Tabs.ClassName.TABS);\n    this.element.setAttribute('role', 'tablist');\n\n    // Tab wrappers.\n    this.tabs.forEach((tab) => {\n      tab.setAttribute('role', 'presentation');\n    });\n\n    // Tab (anchor) elements.\n    this.anchors.forEach((anchor, i) => {\n      anchor.setAttribute('role', 'tab');\n      anchor.setAttribute('tabIndex', -1);\n      anchor.setAttribute('aria-selected', false);\n\n      giveId(anchor, uniqueId);\n\n      const pane = this.panes[i];\n      anchor.setAttribute('aria-controls', pane.id);\n      pane.setAttribute('aria-labelledby', anchor.id);\n    });\n\n    // Panes.\n    this.panes.forEach((pane) => {\n      pane.setAttribute('role', 'tabpanel');\n      pane.setAttribute('aria-hidden', true);\n    });\n  }\n\n  /**\n   * Bind event listeners.\n   * @protected\n   */\n  _setupHandlers() {\n    this._onClick = this._handleClick.bind(this);\n    this._onKeydown = this._handleKeydown.bind(this);\n    this._onHashChange = this._handleHashChange.bind(this);\n\n    this.element.addEventListener('click', this._onClick);\n    this.element.addEventListener('keydown', this._onKeydown);\n    window.addEventListener('hashchange', this._onHashChange);\n    this._resizeId = OdoWindowEvents.onResize(this.update.bind(this));\n  }\n\n  /**\n   * Delegated click listener. Look for a tab close to the target and select it\n   * if it exists.\n   * @param {MouseEvent} evt Event object.\n   * @private\n   */\n  _handleClick(evt) {\n    evt.preventDefault();\n\n    const tab = evt.target.closest('.' + Tabs.ClassName.TAB);\n    if (tab) {\n      this.setSelectedIndex(this.tabs.indexOf(tab));\n    }\n  }\n\n  /**\n   * Key pressed on the tab list. Change focus or select the tab.\n   * @param {KeyboardEvent} evt Event object.\n   * @private\n   */\n  _handleKeydown(evt) {\n    let focusedIndex = this._getFocusedTabIndex();\n\n    switch (evt.which) {\n      // Right | Down\n      case 39:\n      case 40:\n        focusedIndex += 1;\n        break;\n\n      // Left | Up\n      case 37:\n      case 38:\n        focusedIndex -= 1;\n        break;\n\n      // Spacebar | Enter\n      case 32:\n      case 13:\n        evt.preventDefault();\n        this.setSelectedIndex(focusedIndex);\n        return;\n      default:\n        return;\n    }\n\n    evt.preventDefault();\n    this._focusTab(clamp(focusedIndex, 0, this.tabs.length - 1));\n  }\n\n  /**\n   * URL hash changed, see if the hash matches one of the hashes stored and if it\n   * does, navigate to that pane.\n   * @private\n   */\n  _handleHashChange() {\n    const hashIndex = this._getWindowHashIndex();\n    if (hashIndex > -1) {\n      this.setSelectedIndex(hashIndex);\n    }\n  }\n\n  /**\n   * Reset the height of the pane parent.\n   * @private\n   */\n  update() {\n    const currentPane = this.panes[this.getSelectedIndex()];\n    const newHeight = currentPane.offsetHeight;\n    this.panesContainer.style.height = newHeight + 'px';\n  }\n\n  /**\n   * Retrieve the hash without the `#` from the url.\n   * @return {number}\n   * @private\n   */\n  _getWindowHashIndex() {\n    return this.hashes.indexOf(window.location.hash.substring(1));\n  }\n\n  /**\n   * Find the index of the currently focused tab.\n   * @return {number}\n   * @private\n   */\n  _getFocusedTabIndex() {\n    const focusedTab = document.activeElement.closest('.' + Tabs.ClassName.TAB);\n    return this.tabs.indexOf(focusedTab);\n  }\n\n  /**\n   * Focus on a tab.\n   * @param {number} index Tab index to focus on.\n   * @private\n   */\n  _focusTab(index) {\n    this.anchors[index].focus();\n  }\n\n  /**\n   * Returns the currently selected index.\n   * @return {number}\n   */\n  getSelectedIndex() {\n    return this._selectedIndex;\n  }\n\n  /**\n   * Set the selected index to a new value. Will exit early if the index is out of\n   * range, or the index is the same as the current one.\n   * @param {number} index Index to go to.\n   * @param {boolean} [skipHash] Whether to skip setting the hash.\n   */\n  setSelectedIndex(index, skipHash) {\n    if (index === this._selectedIndex || index < 0 || index >= this.tabs.length) {\n      return;\n    }\n\n    // Trigger the will show event and give listeners a chance to cancel showing\n    // the tab/pane.\n    const willShowEvent = new TabsEvent(Tabs.EventType.WILL_SHOW, index);\n    this.emit(willShowEvent.type, willShowEvent);\n\n    if (willShowEvent.defaultPrevented) {\n      return;\n    }\n\n    this._selectTab(index);\n    this._selectPane(index);\n\n    this._selectedIndex = index;\n\n    if (!skipHash && this.hashes[index]) {\n      setHash(this.hashes[index]);\n    }\n\n    const didShowEvent = new TabsEvent(Tabs.EventType.DID_SHOW, index);\n    this.emit(didShowEvent.type, didShowEvent);\n  }\n\n  /**\n   * Update the selected tab.\n   * @param {number} index Index of the new tab.\n   * @private\n   */\n  _selectTab(index) {\n    const newTab = this.tabs[index];\n    const oldTab = this.tabs[this.getSelectedIndex()];\n    const newAnchor = this.anchors[index];\n    const oldAnchor = this.anchors[this.getSelectedIndex()];\n\n    if (oldTab) {\n      oldTab.classList.remove(Tabs.ClassName.IS_SELECTED);\n      oldAnchor.classList.remove(Tabs.ClassName.IS_SELECTED);\n      oldAnchor.setAttribute('tabIndex', -1);\n      oldAnchor.setAttribute('aria-selected', false);\n    }\n\n    newTab.classList.add(Tabs.ClassName.IS_SELECTED);\n    newAnchor.classList.add(Tabs.ClassName.IS_SELECTED);\n    newAnchor.setAttribute('tabIndex', 0);\n    newAnchor.setAttribute('aria-selected', true);\n  }\n\n  /**\n   * Update the selected pane. Handles aria states.\n   * @param {number} index Index of the new pane.\n   * @private\n   */\n  _selectPane(index) {\n    const newPane = this.panes[index];\n    const oldPane = this.panes[this.getSelectedIndex()];\n    const newHeight = newPane.offsetHeight;\n\n    if (oldPane) {\n      oldPane.classList.remove(Tabs.ClassName.IS_SELECTED);\n      oldPane.setAttribute('aria-hidden', true);\n    }\n\n    newPane.classList.add(Tabs.ClassName.IS_SELECTED);\n    newPane.setAttribute('aria-hidden', false);\n\n    this.panesContainer.style.height = newHeight + 'px';\n  }\n\n  /**\n   * Remove event listeners, classes, attributes, and other things added by this script.\n   */\n  dispose() {\n    this.element.classList.remove(Tabs.ClassName.TABS);\n    this.element.removeAttribute('role');\n\n    for (let i = this.tabs.length - 1; i >= 0; i--) {\n      const tab = this.tabs[i];\n      const anchor = this.anchors[i];\n      const pane = this.panes[i];\n\n      tab.classList.remove(Tabs.ClassName.IS_SELECTED);\n      anchor.classList.remove(Tabs.ClassName.IS_SELECTED);\n      pane.classList.remove(Tabs.ClassName.IS_SELECTED);\n      tab.removeAttribute('role');\n      anchor.removeAttribute('role');\n      anchor.removeAttribute('tabIndex');\n      anchor.removeAttribute('aria-selected');\n      anchor.removeAttribute('aria-controls');\n      pane.removeAttribute('role');\n      pane.removeAttribute('aria-labelledby');\n      pane.removeAttribute('aria-hidden');\n    }\n\n    this.panesContainer.style.height = '';\n\n    this.element.removeEventListener('click', this._onClick);\n    this.element.removeEventListener('keydown', this._onKeydown);\n    window.removeEventListener('hashchange', this._onHashChange);\n    OdoWindowEvents.remove(this._resizeId);\n\n    this.element = null;\n    this.anchors = null;\n    this.panes = null;\n    this.panesContainer = null;\n    this._selectedIndex = -1;\n  }\n}\n\nTabs.ClassName = {\n  TABS: 'odo-tabs',\n  TAB: 'odo-tabs__tab',\n  IS_SELECTED: 'is-selected',\n};\n\nTabs.EventType = {\n  WILL_SHOW: 'odotabs:willshow',\n  DID_SHOW: 'odotabs:didshow',\n};\n\nexport default Tabs;\n"],"names":["TabsEvent","type","index","defaultPrevented","preventDefault","id","uniqueId","Tabs","element","_selectedIndex","tabs","Array","from","children","anchors","map","tab","querySelector","panes","document","getElementById","anchor","getAttribute","substring","panesContainer","parentElement","hashes","init","startIndex","getStartingIndex","_setupHandlers","_processTabs","setSelectedIndex","hashIndex","_getWindowHashIndex","findIndex","pane","matches","ClassName","IS_SELECTED","classList","add","TABS","setAttribute","forEach","i","giveId","_onClick","_handleClick","bind","_onKeydown","_handleKeydown","_onHashChange","_handleHashChange","addEventListener","window","_resizeId","OdoWindowEvents","onResize","update","evt","target","closest","TAB","indexOf","focusedIndex","_getFocusedTabIndex","which","_focusTab","clamp","length","currentPane","getSelectedIndex","newHeight","offsetHeight","style","height","location","hash","focusedTab","activeElement","focus","skipHash","willShowEvent","EventType","WILL_SHOW","emit","_selectTab","_selectPane","setHash","didShowEvent","DID_SHOW","newTab","oldTab","newAnchor","oldAnchor","remove","newPane","oldPane","dispose","removeAttribute","removeEventListener","TinyEmitter"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAAMA;EACJ;;;;;;EAMA,qBAAYC,IAAZ,EAAkBC,KAAlB,EAAyB;EAAA;;EACvB,SAAKD,IAAL,GAAYA,IAAZ;;EAEA;EACA,SAAKC,KAAL,GAAaA,KAAb;;EAEA;EACA,SAAKC,gBAAL,GAAwB,KAAxB;EACD;;wBAEDC,2CAAiB;EACf,SAAKD,gBAAL,GAAwB,IAAxB;EACD;;;;;ECnBH;;;;;;;;;;;EAgBA,IAAIE,KAAK,CAAT;EACA,SAASC,QAAT,GAAoB;EAClBD,QAAM,CAAN;EACA,sBAAkBA,EAAlB;EACD;;MAEKE;;;EACJ;;;;;EAKA,gBAAYC,OAAZ,EAAqB;EAAA;;EAGnB;EAHmB,gDACnB,uBADmB;;EAInB,UAAKA,OAAL,GAAeA,OAAf;;EAEA;EACA,UAAKC,cAAL,GAAsB,CAAC,CAAvB;;EAEA;;;;EAIA,UAAKC,IAAL,GAAYC,MAAMC,IAAN,CAAW,MAAKJ,OAAL,CAAaK,QAAxB,CAAZ;;EAEA;;;;EAIA,UAAKC,OAAL,GAAe,MAAKJ,IAAL,CAAUK,GAAV,CAAc;EAAA,aAAOC,IAAIC,aAAJ,CAAkB,GAAlB,CAAP;EAAA,KAAd,CAAf;;EAEA;;;;EAIA,UAAKC,KAAL,GAAa,MAAKJ,OAAL,CAAaC,GAAb,CAAiB;EAAA,aAAUI,SAASC,cAAT,CAAwBC,OAAOC,YAAP,CAAoB,MAApB,EAA4BC,SAA5B,CAAsC,CAAtC,CAAxB,CAAV;EAAA,KAAjB,CAAb;;EAEA;;;;EAIA,UAAKC,cAAL,GAAsB,MAAKN,KAAL,CAAW,CAAX,EAAcO,aAApC;;EAEA;;;;EAIA,UAAKC,MAAL,GAAc,MAAKZ,OAAL,CAAaC,GAAb,CAAiB;EAAA,aAAUM,OAAOC,YAAP,CAAoB,WAApB,CAAV;EAAA,KAAjB,CAAd;;EAEA,UAAKK,IAAL;EAvCmB;EAwCpB;;mBAEDA,uBAAO;EACL,QAAMC,aAAa,KAAKC,gBAAL,EAAnB;;EAEA;EACA,SAAKC,cAAL;;EAEA;EACA,SAAKC,YAAL;;EAEA;EACA,SAAKC,gBAAL,CAAsBJ,UAAtB,EAAkC,IAAlC;EACD;;EAED;;;;;;;;mBAMAC,+CAAmB;EACjB,QAAMI,YAAY,KAAKC,mBAAL,EAAlB;;EAEA,QAAID,YAAY,CAAC,CAAjB,EAAoB;EAClB,aAAOA,SAAP;EACD;;EAED,QAAML,aAAa,KAAKV,KAAL,CAAWiB,SAAX,CAAqB;EAAA,aAAQC,KAAKC,OAAL,CAAa,MAAM9B,KAAK+B,SAAL,CAAeC,WAAlC,CAAR;EAAA,KAArB,CAAnB;;EAEA,QAAIX,aAAa,CAAC,CAAlB,EAAqB;EACnB,aAAOA,UAAP;EACD;;EAED,WAAO,CAAP;EACD;;EAED;;;;;;mBAIAG,uCAAe;EAAA;;EACb,SAAKvB,OAAL,CAAagC,SAAb,CAAuBC,GAAvB,CAA2BlC,KAAK+B,SAAL,CAAeI,IAA1C;EACA,SAAKlC,OAAL,CAAamC,YAAb,CAA0B,MAA1B,EAAkC,SAAlC;;EAEA;EACA,SAAKjC,IAAL,CAAUkC,OAAV,CAAkB,UAAC5B,GAAD,EAAS;EACzBA,UAAI2B,YAAJ,CAAiB,MAAjB,EAAyB,cAAzB;EACD,KAFD;;EAIA;EACA,SAAK7B,OAAL,CAAa8B,OAAb,CAAqB,UAACvB,MAAD,EAASwB,CAAT,EAAe;EAClCxB,aAAOsB,YAAP,CAAoB,MAApB,EAA4B,KAA5B;EACAtB,aAAOsB,YAAP,CAAoB,UAApB,EAAgC,CAAC,CAAjC;EACAtB,aAAOsB,YAAP,CAAoB,eAApB,EAAqC,KAArC;;EAEAG,wBAAOzB,MAAP,EAAef,QAAf;;EAEA,UAAM8B,OAAO,OAAKlB,KAAL,CAAW2B,CAAX,CAAb;EACAxB,aAAOsB,YAAP,CAAoB,eAApB,EAAqCP,KAAK/B,EAA1C;EACA+B,WAAKO,YAAL,CAAkB,iBAAlB,EAAqCtB,OAAOhB,EAA5C;EACD,KAVD;;EAYA;EACA,SAAKa,KAAL,CAAW0B,OAAX,CAAmB,UAACR,IAAD,EAAU;EAC3BA,WAAKO,YAAL,CAAkB,MAAlB,EAA0B,UAA1B;EACAP,WAAKO,YAAL,CAAkB,aAAlB,EAAiC,IAAjC;EACD,KAHD;EAID;;EAED;;;;;;mBAIAb,2CAAiB;EACf,SAAKiB,QAAL,GAAgB,KAAKC,YAAL,CAAkBC,IAAlB,CAAuB,IAAvB,CAAhB;EACA,SAAKC,UAAL,GAAkB,KAAKC,cAAL,CAAoBF,IAApB,CAAyB,IAAzB,CAAlB;EACA,SAAKG,aAAL,GAAqB,KAAKC,iBAAL,CAAuBJ,IAAvB,CAA4B,IAA5B,CAArB;;EAEA,SAAKzC,OAAL,CAAa8C,gBAAb,CAA8B,OAA9B,EAAuC,KAAKP,QAA5C;EACA,SAAKvC,OAAL,CAAa8C,gBAAb,CAA8B,SAA9B,EAAyC,KAAKJ,UAA9C;EACAK,WAAOD,gBAAP,CAAwB,YAAxB,EAAsC,KAAKF,aAA3C;EACA,SAAKI,SAAL,GAAiBC,gBAAgBC,QAAhB,CAAyB,KAAKC,MAAL,CAAYV,IAAZ,CAAiB,IAAjB,CAAzB,CAAjB;EACD;;EAED;;;;;;;;mBAMAD,qCAAaY,KAAK;EAChBA,QAAIxD,cAAJ;;EAEA,QAAMY,MAAM4C,IAAIC,MAAJ,CAAWC,OAAX,CAAmB,MAAMvD,KAAK+B,SAAL,CAAeyB,GAAxC,CAAZ;EACA,QAAI/C,GAAJ,EAAS;EACP,WAAKgB,gBAAL,CAAsB,KAAKtB,IAAL,CAAUsD,OAAV,CAAkBhD,GAAlB,CAAtB;EACD;EACF;;EAED;;;;;;;mBAKAmC,yCAAeS,KAAK;EAClB,QAAIK,eAAe,KAAKC,mBAAL,EAAnB;;EAEA,YAAQN,IAAIO,KAAZ;EACE;EACA,WAAK,EAAL;EACA,WAAK,EAAL;EACEF,wBAAgB,CAAhB;EACA;;EAEF;EACA,WAAK,EAAL;EACA,WAAK,EAAL;EACEA,wBAAgB,CAAhB;EACA;;EAEF;EACA,WAAK,EAAL;EACA,WAAK,EAAL;EACEL,YAAIxD,cAAJ;EACA,aAAK4B,gBAAL,CAAsBiC,YAAtB;EACA;EACF;EACE;EApBJ;;EAuBAL,QAAIxD,cAAJ;EACA,SAAKgE,SAAL,CAAeC,iBAAMJ,YAAN,EAAoB,CAApB,EAAuB,KAAKvD,IAAL,CAAU4D,MAAV,GAAmB,CAA1C,CAAf;EACD;;EAED;;;;;;;mBAKAjB,iDAAoB;EAClB,QAAMpB,YAAY,KAAKC,mBAAL,EAAlB;EACA,QAAID,YAAY,CAAC,CAAjB,EAAoB;EAClB,WAAKD,gBAAL,CAAsBC,SAAtB;EACD;EACF;;EAED;;;;;;mBAIA0B,2BAAS;EACP,QAAMY,cAAc,KAAKrD,KAAL,CAAW,KAAKsD,gBAAL,EAAX,CAApB;EACA,QAAMC,YAAYF,YAAYG,YAA9B;EACA,SAAKlD,cAAL,CAAoBmD,KAApB,CAA0BC,MAA1B,GAAmCH,YAAY,IAA/C;EACD;;EAED;;;;;;;mBAKAvC,qDAAsB;EACpB,WAAO,KAAKR,MAAL,CAAYsC,OAAZ,CAAoBT,OAAOsB,QAAP,CAAgBC,IAAhB,CAAqBvD,SAArB,CAA+B,CAA/B,CAApB,CAAP;EACD;;EAED;;;;;;;mBAKA2C,qDAAsB;EACpB,QAAMa,aAAa5D,SAAS6D,aAAT,CAAuBlB,OAAvB,CAA+B,MAAMvD,KAAK+B,SAAL,CAAeyB,GAApD,CAAnB;EACA,WAAO,KAAKrD,IAAL,CAAUsD,OAAV,CAAkBe,UAAlB,CAAP;EACD;;EAED;;;;;;;mBAKAX,+BAAUlE,OAAO;EACf,SAAKY,OAAL,CAAaZ,KAAb,EAAoB+E,KAApB;EACD;;EAED;;;;;;mBAIAT,+CAAmB;EACjB,WAAO,KAAK/D,cAAZ;EACD;;EAED;;;;;;;;mBAMAuB,6CAAiB9B,OAAOgF,UAAU;EAChC,QAAIhF,UAAU,KAAKO,cAAf,IAAiCP,QAAQ,CAAzC,IAA8CA,SAAS,KAAKQ,IAAL,CAAU4D,MAArE,EAA6E;EAC3E;EACD;;EAED;EACA;EACA,QAAMa,gBAAgB,IAAInF,SAAJ,CAAcO,KAAK6E,SAAL,CAAeC,SAA7B,EAAwCnF,KAAxC,CAAtB;EACA,SAAKoF,IAAL,CAAUH,cAAclF,IAAxB,EAA8BkF,aAA9B;;EAEA,QAAIA,cAAchF,gBAAlB,EAAoC;EAClC;EACD;;EAED,SAAKoF,UAAL,CAAgBrF,KAAhB;EACA,SAAKsF,WAAL,CAAiBtF,KAAjB;;EAEA,SAAKO,cAAL,GAAsBP,KAAtB;;EAEA,QAAI,CAACgF,QAAD,IAAa,KAAKxD,MAAL,CAAYxB,KAAZ,CAAjB,EAAqC;EACnCuF,yBAAQ,KAAK/D,MAAL,CAAYxB,KAAZ,CAAR;EACD;;EAED,QAAMwF,eAAe,IAAI1F,SAAJ,CAAcO,KAAK6E,SAAL,CAAeO,QAA7B,EAAuCzF,KAAvC,CAArB;EACA,SAAKoF,IAAL,CAAUI,aAAazF,IAAvB,EAA6ByF,YAA7B;EACD;;EAED;;;;;;;mBAKAH,iCAAWrF,OAAO;EAChB,QAAM0F,SAAS,KAAKlF,IAAL,CAAUR,KAAV,CAAf;EACA,QAAM2F,SAAS,KAAKnF,IAAL,CAAU,KAAK8D,gBAAL,EAAV,CAAf;EACA,QAAMsB,YAAY,KAAKhF,OAAL,CAAaZ,KAAb,CAAlB;EACA,QAAM6F,YAAY,KAAKjF,OAAL,CAAa,KAAK0D,gBAAL,EAAb,CAAlB;;EAEA,QAAIqB,MAAJ,EAAY;EACVA,aAAOrD,SAAP,CAAiBwD,MAAjB,CAAwBzF,KAAK+B,SAAL,CAAeC,WAAvC;EACAwD,gBAAUvD,SAAV,CAAoBwD,MAApB,CAA2BzF,KAAK+B,SAAL,CAAeC,WAA1C;EACAwD,gBAAUpD,YAAV,CAAuB,UAAvB,EAAmC,CAAC,CAApC;EACAoD,gBAAUpD,YAAV,CAAuB,eAAvB,EAAwC,KAAxC;EACD;;EAEDiD,WAAOpD,SAAP,CAAiBC,GAAjB,CAAqBlC,KAAK+B,SAAL,CAAeC,WAApC;EACAuD,cAAUtD,SAAV,CAAoBC,GAApB,CAAwBlC,KAAK+B,SAAL,CAAeC,WAAvC;EACAuD,cAAUnD,YAAV,CAAuB,UAAvB,EAAmC,CAAnC;EACAmD,cAAUnD,YAAV,CAAuB,eAAvB,EAAwC,IAAxC;EACD;;EAED;;;;;;;mBAKA6C,mCAAYtF,OAAO;EACjB,QAAM+F,UAAU,KAAK/E,KAAL,CAAWhB,KAAX,CAAhB;EACA,QAAMgG,UAAU,KAAKhF,KAAL,CAAW,KAAKsD,gBAAL,EAAX,CAAhB;EACA,QAAMC,YAAYwB,QAAQvB,YAA1B;;EAEA,QAAIwB,OAAJ,EAAa;EACXA,cAAQ1D,SAAR,CAAkBwD,MAAlB,CAAyBzF,KAAK+B,SAAL,CAAeC,WAAxC;EACA2D,cAAQvD,YAAR,CAAqB,aAArB,EAAoC,IAApC;EACD;;EAEDsD,YAAQzD,SAAR,CAAkBC,GAAlB,CAAsBlC,KAAK+B,SAAL,CAAeC,WAArC;EACA0D,YAAQtD,YAAR,CAAqB,aAArB,EAAoC,KAApC;;EAEA,SAAKnB,cAAL,CAAoBmD,KAApB,CAA0BC,MAA1B,GAAmCH,YAAY,IAA/C;EACD;;EAED;;;;;mBAGA0B,6BAAU;EACR,SAAK3F,OAAL,CAAagC,SAAb,CAAuBwD,MAAvB,CAA8BzF,KAAK+B,SAAL,CAAeI,IAA7C;EACA,SAAKlC,OAAL,CAAa4F,eAAb,CAA6B,MAA7B;;EAEA,SAAK,IAAIvD,IAAI,KAAKnC,IAAL,CAAU4D,MAAV,GAAmB,CAAhC,EAAmCzB,KAAK,CAAxC,EAA2CA,GAA3C,EAAgD;EAC9C,UAAM7B,MAAM,KAAKN,IAAL,CAAUmC,CAAV,CAAZ;EACA,UAAMxB,SAAS,KAAKP,OAAL,CAAa+B,CAAb,CAAf;EACA,UAAMT,OAAO,KAAKlB,KAAL,CAAW2B,CAAX,CAAb;;EAEA7B,UAAIwB,SAAJ,CAAcwD,MAAd,CAAqBzF,KAAK+B,SAAL,CAAeC,WAApC;EACAlB,aAAOmB,SAAP,CAAiBwD,MAAjB,CAAwBzF,KAAK+B,SAAL,CAAeC,WAAvC;EACAH,WAAKI,SAAL,CAAewD,MAAf,CAAsBzF,KAAK+B,SAAL,CAAeC,WAArC;EACAvB,UAAIoF,eAAJ,CAAoB,MAApB;EACA/E,aAAO+E,eAAP,CAAuB,MAAvB;EACA/E,aAAO+E,eAAP,CAAuB,UAAvB;EACA/E,aAAO+E,eAAP,CAAuB,eAAvB;EACA/E,aAAO+E,eAAP,CAAuB,eAAvB;EACAhE,WAAKgE,eAAL,CAAqB,MAArB;EACAhE,WAAKgE,eAAL,CAAqB,iBAArB;EACAhE,WAAKgE,eAAL,CAAqB,aAArB;EACD;;EAED,SAAK5E,cAAL,CAAoBmD,KAApB,CAA0BC,MAA1B,GAAmC,EAAnC;;EAEA,SAAKpE,OAAL,CAAa6F,mBAAb,CAAiC,OAAjC,EAA0C,KAAKtD,QAA/C;EACA,SAAKvC,OAAL,CAAa6F,mBAAb,CAAiC,SAAjC,EAA4C,KAAKnD,UAAjD;EACAK,WAAO8C,mBAAP,CAA2B,YAA3B,EAAyC,KAAKjD,aAA9C;EACAK,oBAAgBuC,MAAhB,CAAuB,KAAKxC,SAA5B;;EAEA,SAAKhD,OAAL,GAAe,IAAf;EACA,SAAKM,OAAL,GAAe,IAAf;EACA,SAAKI,KAAL,GAAa,IAAb;EACA,SAAKM,cAAL,GAAsB,IAAtB;EACA,SAAKf,cAAL,GAAsB,CAAC,CAAvB;EACD;;;IAlWgB6F;;EAqWnB/F,KAAK+B,SAAL,GAAiB;EACfI,QAAM,UADS;EAEfqB,OAAK,eAFU;EAGfxB,eAAa;EAHE,CAAjB;;EAMAhC,KAAK6E,SAAL,GAAiB;EACfC,aAAW,kBADI;EAEfM,YAAU;EAFK,CAAjB;;;;;;;;"}