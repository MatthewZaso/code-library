{"version":3,"file":"odo-module.js","sources":["../node_modules/request-idle-callback/index.js","../src/module-utils.js","../src/module-methods.js","../src/module.js"],"sourcesContent":["var requestIdleCallback =\n  function (cb) {\n  if (global.requestIdleCallback) return global.requestIdleCallback(cb)\n    var start = Date.now();\n    return setTimeout(function () {\n      cb({\n        didTimeout: false,\n        timeRemaining: function () {\n          return Math.max(0, 50 - (Date.now() - start));\n        }\n      });\n    }, 1);\n  }\n\nvar cancelIdleCallback =\n  function (id) {\n  if (global.cancelIdleCallback) return global.cancelIdleCallback(id)\n    return clearTimeout(id);\n  }\n\nexports.requestIdleCallback = requestIdleCallback\nexports.cancelIdleCallback = cancelIdleCallback\n","/**\n * Utilities for the Odo Module component.\n *\n * @author Nathan Buchar\n */\n\n/**\n * If the first parameter is not an array, return an array containing the\n * first parameter.\n *\n * @author Glen Cheney <glen@odopod.com>\n * @param {*} thing - Anything.\n * @returns {Array.<*>} Array of things.\n */\nexport function arrayify(thing) {\n  if (Array.isArray(thing)) {\n    return thing;\n  }\n\n  if (thing && typeof thing.length === 'number') {\n    return Array.from(thing);\n  }\n\n  return [thing];\n}\n\n/**\n * Determine if the given item is an HTMLElement. Adapted from\n * {@link http://stackoverflow.com/a/36894871/373422}\n *\n * @param {*} thing - Anything.\n * @returns {boolean}\n */\nexport function isHTMLElement(thing) {\n  return thing instanceof Element;\n}\n","/**\n * Any method defined here will be automatically applied to all OdoModules.\n *\n * @author Nathan Buchar\n */\n\nimport { requestIdleCallback } from 'request-idle-callback';\nimport { arrayify, isHTMLElement } from './module-utils';\n\nexport default (Module, selector) => ({\n  /**\n   * Gets the Module instance for a given element, if it has been created.\n   * Returns undefined if no instance was found for this element.\n   *\n   * @param {HTMLElement} element\n   * @returns {?Module}\n   */\n  getInstance(element) {\n    return Module.Instances.get(element);\n  },\n\n  /**\n   * Removes a given module instance from the Instances Map and calls the\n   * \"dispose\" method on the instance, if it is implemented. Returns true if\n   * the module instance was removed, or false if no module instance\n   * exists for the given element\n   *\n   * @param {HTMLElement} element\n   * @returns {boolean}\n   */\n  deleteInstance(element) {\n    const instance = Module.getInstance(element);\n\n    if (instance) {\n      Module.Instances.delete(element);\n\n      // Call the \"dispose\" method if it is implemented by the module.\n      if (typeof instance.dispose === 'function') {\n        instance.dispose();\n      }\n\n      return true;\n    }\n\n    return false;\n  },\n\n  /**\n   * Initalize Components from an element, or an array or NodeList of\n   * elements. Returns a Map of all instances created, keyed by their\n   * respective base elements.\n   *\n   * @param {HTMLElement|HTMLElement[]|NodeList} elements\n   * @param {Object} [options={}]\n   * @returns {Map} instances\n   */\n  initialize(elements, options = {}) {\n    if (typeof elements === 'undefined') {\n      throw new TypeError('Element(s) to initialize must be defined.');\n    }\n\n    const instances = new Map();\n\n    arrayify(elements).forEach((element) => {\n      // Verify that the element is in fact an HTML Element.\n      if (!isHTMLElement(element)) {\n        throw new TypeError(`Expected HTML Element. Got \"${Object.prototype.toString.call(element)}\".`);\n      }\n\n      // Verify that an instance has not already been initialized for this element.\n      if (Module.Instances.has(element)) {\n        // eslint-disable-next-line no-console\n        console.warn('An instance has already been initialized for this element.');\n        return;\n      }\n\n      const instance = new Module(element, options);\n\n      instances.set(element, instance);\n      Module.Instances.set(element, instance);\n    });\n\n    return instances;\n  },\n\n  /**\n   * Initializes all Module within the given context.\n   * @param {HTMLElement|HTMLDocument} [context=document]\n   * @param {Object} [options={}]\n   * @returns {Map}\n   */\n  initializeAll(context = document, options = {}) {\n    return Module.initialize(context.querySelectorAll(selector), options);\n  },\n\n  /**\n   * Initialize all modules within a context when the browser has a moment of\n   * idle time.\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/requestIdleCallback\n   * @param {HTMLElement|HTMLDocument} [context]\n   * @param {Object} [options]\n   * @return {Promise.<Map>} A promise which resolves when the modules have been initialized.\n   */\n  initializeWhenIdle(context, options) {\n    return new Promise((resolve) => {\n      requestIdleCallback(() => {\n        resolve(Module.initializeAll(context, options));\n      });\n    });\n  },\n\n  /**\n   * Initializes all Module within the given context.\n   * @param {HTMLElement|HTMLDocument} [context=document]\n   */\n  disposeAll(context = document) {\n    arrayify(context.querySelectorAll(selector)).forEach((element) => {\n      Module.deleteInstance(element);\n    });\n  },\n});\n","/**\n * Entry point into the Odo Module component. Exposes a single `register`\n * static property, which when called will register the given base selector\n * with the given module class and apply several static methods and properties.\n *\n * @author Nathan Buchar\n */\n\nimport OdoModuleMethods from './module-methods';\n\n/**\n * A map of all registered modules, keyed by the base selector. No two\n * registers may share the same base selector.\n * @type {Map}\n * @private\n */\nconst store = new Map();\n\n/**\n * Determine the base selector for this module.\n * @param {Object} Module\n * @param {string} [selector]\n * @return {string} Updated selector string.\n * @throws {TypeError} If the selector cannot be determined.\n */\nfunction getSelector(Module, selector) {\n  // Verify that a base selector is defined.\n  if (typeof selector === 'undefined') {\n    if (Module.Selectors && Module.Selectors.BASE) {\n      return Module.Selectors.BASE;\n    }\n\n    // Support both `ClassName` and `Classes` enumerations.\n    const classes = Module.ClassName || Module.Classes;\n    if (classes && classes.BASE) {\n      return '.' + classes.BASE;\n    }\n\n    throw new TypeError('A base selector for this module must be specified.');\n  }\n\n  return selector;\n}\n\n/**\n * Ensure all required properties exist.\n * @param {Object} Module\n * @param {string} [selector]\n * @throws {TypeError} When something is missing.\n * @private\n */\nfunction validate(Module, selector) {\n  // Verify that the Module is an Object or Class.\n  const type = Object.prototype.toString.call(Module);\n  const isObject = type === '[object Object]';\n  const isFunction = type === '[object Function]';\n  if (!(isObject || isFunction)) {\n    throw new TypeError(`Module must be an Function (class) or Object. Got \"${Object.prototype.toString.call(Module)}\".`);\n  }\n\n  // Verify that the module has not yet been registered.\n  if (store.has(selector)) {\n    throw new TypeError('The base selector for this module has already been registered. Please use a unique base selector.');\n  }\n}\n\n/**\n * Adds static methods and internally registers the module.\n * @param {Object} Module\n * @param {string} [selector]\n * @return {Object} The module.\n */\nfunction register(Module, selector) {\n  const _selector = getSelector(Module, selector);\n\n  validate(Module, _selector);\n\n  const methods = OdoModuleMethods(Module, _selector);\n\n  // Apply OdoModule static methods.\n  Object.keys(methods).forEach((method) => {\n    Module[method] = methods[method];\n  });\n\n  // Apply the OdoModule static property.\n  Module.Instances = new Map();\n\n  // Internally register the module.\n  store.set(_selector, Module);\n\n  return Module;\n}\n\n/**\n * Forget about this module. Currently leaves methods and instances as-is in\n * case they're needed.\n * @param {Object} Module\n * @param {string} [selector]\n */\nfunction unregister(Module, selector) {\n  const _selector = getSelector(Module, selector);\n\n  // Internally unregister the module.\n  store.delete(_selector);\n}\n\nexport default { register, unregister };\n"],"names":["requestIdleCallback","cb","global","start","Date","now","setTimeout","didTimeout","timeRemaining","Math","max","arrayify","thing","Array","isArray","length","from","isHTMLElement","Element","Module","selector","getInstance","element","Instances","get","deleteInstance","instance","delete","dispose","initialize","elements","options","TypeError","instances","Map","forEach","Object","prototype","toString","call","has","console","warn","set","initializeAll","context","document","querySelectorAll","initializeWhenIdle","Promise","resolve","disposeAll","store","getSelector","Selectors","BASE","classes","ClassName","Classes","validate","type","isObject","isFunction","register","_selector","methods","OdoModuleMethods","keys","method","unregister"],"mappings":"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"}