{"version":3,"file":"odo-scroll-feedback.js","sources":["../src/scroll-feedback.js"],"sourcesContent":["/**\n * @fileoverview The `ScrollFeedback` class listens for input from the user:\n * mouse, keyboard, touch. Based on the input, the `ScrollFeedback` instance will\n * emit navigation events with a `direction` property signifying which way the\n * user should be taken.\n *\n * @author Glen Cheney <glen@odopod.com>\n */\n\nimport TinyEmitter from 'tiny-emitter';\n\n/*\n * Detect passive event listeners.\n * https://developers.google.com/web/updates/2017/01/scrolling-intervention\n * https://github.com/Modernizr/Modernizr/blob/master/feature-detects/dom/passiveeventlisteners.js\n * https://github.com/WICG/EventListenerOptions/blob/gh-pages/explainer.md\n *\n * Weird istanbul ignore:\n * https://github.com/gotwarlost/istanbul/issues/445#issuecomment-150498338\n */\nlet supportsPassiveOption = false;\ntry {\n  window.addEventListener('test', null, {\n    get passive/* istanbul ignore next */() { // eslint-disable-line getter-return\n      supportsPassiveOption = true;\n    },\n  });\n} catch (e) { /* continue */ }\n\nconst KeyCodes = {\n  SPACE: 32,\n  PAGE_UP: 33,\n  PAGE_DOWN: 34,\n  END: 35,\n  HOME: 36,\n  UP: 38,\n  DOWN: 40,\n};\n\nclass ScrollFeedback extends TinyEmitter {\n  constructor(element, options) {\n    super();\n\n    this.element = element;\n\n    this.options = Object.assign({}, ScrollFeedback.Defaults, options);\n    this._listenerOptions = ScrollFeedback.PASSIVE_LISTENERS ? { passive: false } : false;\n\n    this.canScroll = true;\n    this._isUserPaused = false;\n    this.wheelTimeout = null;\n    this.scrollTimeout = null;\n    this.wheelAmount = { x: 0, y: 0 };\n    this.startPosition = { x: 0, y: 0 };\n\n    this._handleWheel = this._handleWheel.bind(this);\n    this._handleKeydown = this._handleKeydown.bind(this);\n    this._handleTouchStart = this._handleTouchStart.bind(this);\n    this._handleTouchMove = this._handleTouchMove.bind(this);\n    this._resume = this._resume.bind(this);\n    this._handleScrollTimerExpired = this._handleScrollTimerExpired.bind(this);\n    this._handleScrollEnd = this._handleScrollEnd.bind(this);\n\n    this.enable();\n  }\n\n  /**\n   * Enable the scroll feedback instance by adding event listeners.\n   */\n  enable() {\n    // `wheel` is the standard, but Safari<8 only supports `mousewheel`.\n    // IE9+, Chrome, Firefox, Opera all use `wheel`.\n    this.element.addEventListener('wheel', this._handleWheel, this._listenerOptions);\n    this.element.addEventListener('mousewheel', this._handleWheel, this._listenerOptions);\n\n    // Use the arrow keys to navigate next and previous as well.\n    document.addEventListener('keydown', this._handleKeydown, this._listenerOptions);\n\n    // Prevent touch events from scrolling the page. They need to be interpreted.\n    document.body.addEventListener('touchstart', this._handleTouchStart, this._listenerOptions);\n    document.body.addEventListener('touchmove', this._handleTouchMove, this._listenerOptions);\n    document.body.addEventListener('touchend', this._resume, this._listenerOptions);\n  }\n\n  /**\n   * Disable the instance by removing event listeners.\n   */\n  disable() {\n    this.element.removeEventListener('wheel', this._handleWheel, this._listenerOptions);\n    this.element.removeEventListener('mousewheel', this._handleWheel, this._listenerOptions);\n\n    document.removeEventListener('keydown', this._handleKeydown, this._listenerOptions);\n\n    document.body.removeEventListener('touchstart', this._handleTouchStart, this._listenerOptions);\n    document.body.removeEventListener('touchmove', this._handleTouchMove, this._listenerOptions);\n    document.body.removeEventListener('touchend', this._resume, this._listenerOptions);\n  }\n\n  /**\n   * Mouse wheel event. The cross-browser code is from iScroll 5.\n   * @param {Event} evt Event object.\n   * @private\n   */\n  _handleWheel(evt) {\n    if (this._shouldIgnoreEvent(evt.target)) {\n      return;\n    }\n\n    if (this.canScroll) {\n      clearTimeout(this.scrollTimeout);\n      this.scrollTimeout = setTimeout(\n        this._handleScrollTimerExpired,\n        this.options.scrollTimerDelay,\n      );\n\n      if (this._intentToNavigate(this.wheelAmount)) {\n        this._triggerNavigation(this.wheelAmount);\n        this._pause();\n      }\n    }\n\n    // Execute the scrollEnd event after 300ms the wheel stopped scrolling\n    clearTimeout(this.wheelTimeout);\n    this.wheelTimeout = setTimeout(this._handleScrollEnd, this.options.scrollEndDelay);\n\n    // Wheeling amount since the last wheel event.\n    const { x, y } = this._getWheelDelta(evt);\n\n    // Using prevent default all the time stops the swipe-to-go-back on the\n    // magic mouse (and probably others). Only prevent the default if there is\n    // no vertical movement and some horizontal movement.\n    if (!(y === 0 && Math.abs(x) > 0)) {\n      evt.preventDefault();\n      evt.stopPropagation();\n    }\n\n    // Keep a running total of the amount in each direction.\n    this.wheelAmount.x += x;\n    this.wheelAmount.y += y;\n  }\n\n  /**\n   * Before navigating, this function determines if the user has scrolled past\n   * the wheel threshold constant and that they have scrolled more Y (vertical)\n   * than X (horizontal).\n   * @param {{x: number, y: number}} delta Amount moved since last movement.\n   */\n  _intentToNavigate(delta) {\n    const absY = Math.abs(delta.y);\n    const absX = Math.abs(delta.x);\n\n    return absY > this.options.movementThreshold && absY > absX;\n  }\n\n  /**\n   * Trigger the navigation, after it's been determined the user's\n   * intent was to navigate.\n   */\n  _triggerNavigation(delta) {\n    const direction = delta.y < 0 ?\n      ScrollFeedback.Direction.NEXT :\n      ScrollFeedback.Direction.PREVIOUS;\n    this.navigate(direction);\n  }\n\n  /**\n   * Scroll events stopped firing. Reset some things and notify.\n   * @private\n   */\n  _handleScrollEnd() {\n    clearTimeout(this.scrollTimeout);\n    this.wheelTimeout = null;\n    this._resume();\n    this.emit(ScrollFeedback.Events.SCROLL_END);\n    this.wheelAmount = {\n      x: 0,\n      y: 0,\n    };\n  }\n\n  /**\n   * The scroll timer starts when the first intent to navigate is called. If the\n   * user keeps scrolling the page, this timer will expire and trigger the scroll\n   * end event to happen.\n   */\n  _handleScrollTimerExpired() {\n    clearTimeout(this.wheelTimeout);\n    this._handleScrollEnd();\n  }\n\n  /**\n   * Event listener for key down. If a special key is pressed, this class will\n   * emit an event with the direction the page should go.\n   * @param {KeyboardEvent} evt Event object.\n   * @private\n   */\n  _handleKeydown(evt) {\n    let direction = null;\n\n    switch (evt.which) {\n      // Up and page up.\n      // Falls through\n      case KeyCodes.UP:\n      case KeyCodes.PAGE_UP:\n        direction = ScrollFeedback.Direction.PREVIOUS;\n        break;\n\n      // Down arrow and page down.\n      // Falls through\n      case KeyCodes.DOWN:\n      case KeyCodes.PAGE_DOWN:\n        direction = ScrollFeedback.Direction.NEXT;\n        break;\n\n      // Space bar normally scrolls the page down, advance to the next\n      // waypoint on spacebar press. Holding shift and pressing space scrolls\n      // the page up.\n      case KeyCodes.SPACE:\n        if (evt.shiftKey) {\n          direction = ScrollFeedback.Direction.PREVIOUS;\n        } else {\n          direction = ScrollFeedback.Direction.NEXT;\n        }\n\n        break;\n\n      case KeyCodes.HOME:\n        direction = ScrollFeedback.Direction.START;\n        break;\n\n      case KeyCodes.END:\n        direction = ScrollFeedback.Direction.END;\n        break;\n\n      // no default\n    }\n\n    if (direction) {\n      // Stop up and down from scrolling the page.\n      evt.preventDefault();\n      evt.stopPropagation();\n\n      if (this.canScroll) {\n        this.navigate(direction);\n      }\n    }\n  }\n\n  /**\n   * Save the starting position of the user's finger on touch start.\n   * @param {TouchEvent} evt Event object.\n   * @private\n   */\n  _handleTouchStart(evt) {\n    this.startPosition = {\n      x: evt.changedTouches[0].pageX,\n      y: evt.changedTouches[0].pageY,\n    };\n  }\n\n  /**\n   * Emits a navigation event if the user has moved their finger far enough.\n   * @param {TouchEvent} evt Event object.\n   * @private\n   */\n  _handleTouchMove(evt) {\n    if (this._shouldIgnoreEvent(evt.target)) {\n      return;\n    }\n\n    if (!this.canScroll) {\n      evt.preventDefault();\n      return;\n    }\n\n    const pos = {\n      x: evt.changedTouches[0].pageX,\n      y: evt.changedTouches[0].pageY,\n    };\n\n    const delta = {\n      x: pos.x - this.startPosition.x,\n      y: pos.y - this.startPosition.y,\n    };\n\n    if (this._intentToNavigate(delta)) {\n      evt.preventDefault();\n      this._triggerNavigation(delta);\n      this._pause();\n    }\n  }\n\n  /**\n   * Calculate the amount of wheeling since the last wheel event.\n   *\n   * Info on deltaMode in Firefox https://github.com/cubiq/iscroll/issues/577\n   * Wheel event on MDN https://developer.mozilla.org/en-US/docs/Web/Events/wheel\n   *\n   * @param {WheelEvent} e Event object.\n   * @return {{x: number, y: number}}\n   * @private\n   */\n  _getWheelDelta(e) {\n    let wheelDeltaX;\n    let wheelDeltaY;\n\n    // Normalize the wheel delta value.\n    if ('deltaX' in e) {\n      // deltaMode can be three different values: pixels, lines, or pages. 0, 1, or 2.\n      if (e.deltaMode === 1) {\n        wheelDeltaX = -e.deltaX * ScrollFeedback.MOUSE_WHEEL_SPEED;\n        wheelDeltaY = -e.deltaY * ScrollFeedback.MOUSE_WHEEL_SPEED;\n      } else {\n        wheelDeltaX = -e.deltaX;\n        wheelDeltaY = -e.deltaY;\n      }\n\n      // Support Safari<8\n    } else if ('wheelDeltaX' in e) {\n      wheelDeltaX = e.wheelDeltaX / 120 * ScrollFeedback.MOUSE_WHEEL_SPEED;\n      wheelDeltaY = e.wheelDeltaY / 120 * ScrollFeedback.MOUSE_WHEEL_SPEED;\n    }\n\n    return {\n      x: wheelDeltaX,\n      y: wheelDeltaY,\n    };\n  }\n\n  /**\n   * If the element which received the touch move event is one which should\n   * be ignored, exit immidiately.\n   * @param {Element} element Element to test.\n   * @return {boolean} Whether to ignore the event or not.\n   */\n  _shouldIgnoreEvent(element) {\n    return !!this.options.ignore && element.closest(this.options.ignore) !== null;\n  }\n\n  /**\n   * Emits a NAVIGATE event with a direction.\n   * @param {ScrollFeedback.Direction} direction Direction to navigate.\n   */\n  navigate(direction) {\n    this.emit(ScrollFeedback.Events.NAVIGATE, {\n      direction,\n    });\n  }\n\n  /**\n   * Scroll and touch events will not be counted as input.\n   */\n  _pause() {\n    this.canScroll = false;\n  }\n\n  /**\n   * Only set the can scroll flag to true when the user of this component has\n   * not paused it.\n   */\n  _resume() {\n    if (!this._isUserPaused) {\n      this.canScroll = true;\n    }\n  }\n\n  /**\n   * Scroll and touch events will not be counted as input.\n   */\n  pause() {\n    this._isUserPaused = true;\n    this._pause();\n  }\n\n  /**\n   * Counts scrolls and touch events as inputs.\n   */\n  resume() {\n    this._isUserPaused = false;\n    this._resume();\n  }\n\n  /**\n   * Remove DOM references and event handlers.\n   */\n  dispose() {\n    clearTimeout(this.scrollTimeout);\n    clearTimeout(this.wheelTimeout);\n    this.disable();\n    this.element = null;\n  }\n}\n\n/** @enum {string} */\nScrollFeedback.Events = {\n  NAVIGATE: 'odoscrollfeedback:navigate',\n  SCROLL_END: 'odoscrollfeedback:scrollend',\n};\n\n/** @enum {number} */\nScrollFeedback.Direction = {\n  START: 1,\n  PREVIOUS: 2,\n  NEXT: 3,\n  END: 4,\n};\n\n/**\n * Options which can be overriden for the input handler.\n * @type {Object}\n */\nScrollFeedback.Defaults = {\n  ignore: null, // A selector string matching elements which should not be interpreted\n  movementThreshold: 5, // Amount needed in deltaY (touch or mouse wheel) before event is emitted.\n  scrollEndDelay: 350, // The amount of time between scrolls to trigger scroll end\n  scrollTimerDelay: 2000, // Delay before one continuous scroll triggers scroll end\n};\n\nScrollFeedback.MOUSE_WHEEL_SPEED = 20;\n\nScrollFeedback.PASSIVE_LISTENERS = supportsPassiveOption;\n\nexport default ScrollFeedback;\n"],"names":["supportsPassiveOption","window","addEventListener","passive","e","KeyCodes","SPACE","PAGE_UP","PAGE_DOWN","END","HOME","UP","DOWN","ScrollFeedback","element","options","Object","assign","Defaults","_listenerOptions","PASSIVE_LISTENERS","canScroll","_isUserPaused","wheelTimeout","scrollTimeout","wheelAmount","x","y","startPosition","_handleWheel","bind","_handleKeydown","_handleTouchStart","_handleTouchMove","_resume","_handleScrollTimerExpired","_handleScrollEnd","enable","document","body","disable","removeEventListener","evt","_shouldIgnoreEvent","target","clearTimeout","setTimeout","scrollTimerDelay","_intentToNavigate","_triggerNavigation","_pause","scrollEndDelay","_getWheelDelta","Math","abs","preventDefault","stopPropagation","delta","absY","absX","movementThreshold","direction","Direction","NEXT","PREVIOUS","navigate","emit","Events","SCROLL_END","which","shiftKey","START","changedTouches","pageX","pageY","pos","wheelDeltaX","wheelDeltaY","deltaMode","deltaX","MOUSE_WHEEL_SPEED","deltaY","ignore","closest","NAVIGATE","pause","resume","dispose","TinyEmitter"],"mappings":"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"}